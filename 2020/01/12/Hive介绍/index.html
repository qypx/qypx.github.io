<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hadoop,Hive,">










<meta name="keywords" content="Hadoop,Hive">
<meta property="og:type" content="article">
<meta property="og:title" content="Hiveä»‹ç»">
<meta property="og:url" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/index.html">
<meta property="og:site_name" content="qypx ã® blog">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603599880662.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603599824805.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603600131112.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603600188322.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603609902727.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610044780.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610161316.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610193337.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610402205.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603600496450.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603600549196.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603609992170.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610068333.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610449476.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610471246.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610518016.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610616445.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603610644871.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603613699566.png">
<meta property="og:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603614353762.png">
<meta property="og:updated_time" content="2020-10-26T11:11:54.364Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hiveä»‹ç»">
<meta name="twitter:image" content="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/1603599880662.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/">





<!-- ç½‘é¡µåŠ è½½æ¡ -->
<script src="https://neveryu.github.io/js/src/pace.min.js"></script>

  <title>Hiveä»‹ç» | qypx ã® blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">qypx ã® blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">æœºä¼šæ˜¯ç•™ç»™æœ‰å‡†å¤‡çš„äººçš„.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://qypx.github.io/2020/01/12/Hiveä»‹ç»/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qypx">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qypx ã® blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Hiveä»‹ç»</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-01-12T20:26:40+08:00">
                2020-01-12
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">æ›´æ–°äº&#58;</span>
              
              <time title="æ›´æ–°äº" itemprop="dateModified" datetime="2020-10-26T19:11:54+08:00">
                2020-10-26
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> é˜…è¯»é‡
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p> å‚è€ƒï¼š<br><a href="https://blog.csdn.net/PowerBlogger/article/details/83626449" target="_blank" rel="noopener">https://blog.csdn.net/PowerBlogger/article/details/83626449</a><br><a href="https://blog.csdn.net/u010886217/article/details/83796151" target="_blank" rel="noopener">https://blog.csdn.net/u010886217/article/details/83796151</a></p>
<p>æ›´å¤šå†…å®¹è§Hiveå®˜æ–¹æ–‡æ¡£<br><a href="https://cwiki.apache.org/confluence/display/Hive/Home#Home-UserDocumentation" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/Home#Home-UserDocumentation</a></p>
</blockquote>
<h3 id="1-ä»€ä¹ˆæ˜¯Hiveï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯Hiveï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯Hiveï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯Hiveï¼Ÿ</h3><p>Hiveæ˜¯å»ºç«‹åœ¨Hadoopä¸Šçš„ï¼Œç”¨æ¥æ„å»ºæ•°æ®ä»“åº“çš„å·¥å…·ï¼Œé‡Œé¢æœ‰è¡¨çš„æ¦‚å¿µï¼Œå¯ä»¥ä½¿ç”¨SQLè¯­å¥å®ç°å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†æå­˜å‚¨åœ¨ HDFSä¸Šçš„æ•°æ®ï¼Œè¿™äº›SQLè¯­å¥åœ¨Hiveä¸­ç§°ä¸ºHQL (HiveQL)ï¼Œè¯­æ³•å’ŒSQLè¯­å¥åŸºæœ¬ä¸€æ ·ã€‚<br>ç”±äºæ•°æ®æ˜¯æ‚ä¹±æ— ç« çš„ï¼Œæ‰€ä»¥Hiveéœ€è¦ä¸€ä»½å…³äºè¿™äº›æ•°æ®çš„å…ƒæ•°æ®æ¥ç®¡ç†å’Œæ“ä½œè¿™äº›æ•°æ®ã€‚è¿™ä»½å…ƒæ•°æ®åŒ…æ‹¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å…ƒæ•°æ®ï¼ˆ</span><br><span class="line">è¡Œçš„åˆ†éš”ç¬¦ï¼ˆåœ¨æ˜ å°„æˆè¡¨çš„æ—¶å€™çŸ¥é“åœ¨å“ªé‡Œåˆ†è¡Œæ˜¾ç¤ºï¼‰</span><br><span class="line">å­—æ®µåˆ†éš”ç¬¦ï¼ˆåœ¨æ˜ å°„æˆè¡¨çš„æ—¶å€™çŸ¥é“åœ¨å“ªé‡Œåˆ†åˆ—æ˜¾ç¤ºï¼‰</span><br><span class="line">å­—æ®µçš„ç±»å‹</span><br><span class="line">å­—æ®µçš„åç§°</span><br><span class="line">ï¼‰</span><br></pre></td></tr></table></figure>
<p>åœ¨Hiveä¸­ï¼Œæˆ‘ä»¬æŠŠæ•°æ®å­˜å‚¨åœ¨HDFSä¸­ï¼Œå…ƒæ•°æ®é»˜è®¤å­˜å‚¨åœ¨Hiveè‡ªå¸¦çš„Derbyæ•°æ®åº“ä¸­ï¼Œç”±äºDerbyä¸èƒ½å®ç°å¹¶å‘è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨mysqlè¿›è¡Œæ›¿æ¢ã€‚</p>
<h3 id="2-Hiveçš„åŸç†"><a href="#2-Hiveçš„åŸç†" class="headerlink" title="2.Hiveçš„åŸç†"></a>2.Hiveçš„åŸç†</h3><p><strong>Hive å°†ç”¨æˆ·çš„ HQL è¯­å¥è¿›è¡Œè§£æï¼Œä¼˜åŒ–ï¼Œæœ€ç»ˆæŠŠä¸€ä¸ªä¸ªçš„HQLè¯­å¥è½¬æ¢ä¸º MapReduce ä½œä¸šæäº¤åˆ° Hadoop é›†ç¾¤ä¸Šï¼ŒHadoopè¿›è¡Œä½œä¸šçš„è°ƒåº¦åŠç›‘æ§ï¼Œä½œä¸šå®Œæˆåå°†æ‰§è¡Œç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</strong>æ‰€ä»¥ï¼Œ<strong>Hiveå¹¶ä¸è¿›è¡Œè®¡ç®—ï¼Œåªæ˜¯æŠŠHQLè§£æä¸ºMapperReduceåœ¨HDFSé›†ç¾¤ä¸­è¿è¡Œè€Œå·²</strong>ï¼Œæ‰€ä»¥Hiveçš„æ•ˆç‡å¹¶ä¸é«˜ã€‚</p>
<h3 id="3-Hiveå»ºè¡¨è¯­å¥"><a href="#3-Hiveå»ºè¡¨è¯­å¥" class="headerlink" title="3.Hiveå»ºè¡¨è¯­å¥"></a><span id="jump3">3.Hiveå»ºè¡¨è¯­å¥</span></h3><blockquote>
<p>å‚è€ƒ<br><a href="https://blog.csdn.net/qq_36743482/article/details/78383964" target="_blank" rel="noopener">https://blog.csdn.net/qq_36743482/article/details/78383964</a><br><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL</a><br><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML</a></p>
</blockquote>
<p>Hiveå»ºè¡¨æ–¹å¼å…±æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li>ç›´æ¥å»ºè¡¨æ³•</li>
<li>æŸ¥è¯¢å»ºè¡¨æ³•</li>
<li>likeå»ºè¡¨æ³•</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name    -- (Note: TEMPORARY available in Hive 0.14.0 and later)</span><br><span class="line">  [(col_name data_type [column_constraint_specification] [COMMENT col_comment], ... [constraint_specification])]</span><br><span class="line">  [COMMENT table_comment]</span><br><span class="line">  [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]</span><br><span class="line">  [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS]</span><br><span class="line">  [SKEWED BY (col_name, col_name, ...)                  -- (Note: Available in Hive 0.10.0 and later)]</span><br><span class="line">     ON ((col_value, col_value, ...), (col_value, col_value, ...), ...)</span><br><span class="line">     [STORED AS DIRECTORIES]</span><br><span class="line">  [</span><br><span class="line">   [ROW FORMAT row_format] </span><br><span class="line">   [STORED AS file_format]</span><br><span class="line">     | STORED BY &apos;storage.handler.class.name&apos; [WITH SERDEPROPERTIES (...)]  -- (Note: Available in Hive 0.6.0 and later)</span><br><span class="line">  ]</span><br><span class="line">  [LOCATION hdfs_path]</span><br><span class="line">  [TBLPROPERTIES (property_name=property_value, ...)]   -- (Note: Available in Hive 0.6.0 and later)</span><br><span class="line">  [AS select_statement];   -- (Note: Available in Hive 0.5.0 and later; not supported for external tables)</span><br><span class="line"> </span><br><span class="line">CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name</span><br><span class="line">  LIKE existing_table_or_view_name</span><br><span class="line">  [LOCATION hdfs_path];</span><br><span class="line"> </span><br><span class="line">data_type</span><br><span class="line">  : primitive_type</span><br><span class="line">  | array_type</span><br><span class="line">  | map_type</span><br><span class="line">  | struct_type</span><br><span class="line">  | union_type  -- (Note: Available in Hive 0.7.0 and later)</span><br><span class="line"> </span><br><span class="line">primitive_type</span><br><span class="line">  : TINYINT</span><br><span class="line">  | SMALLINT</span><br><span class="line">  | INT</span><br><span class="line">  | BIGINT</span><br><span class="line">  | BOOLEAN</span><br><span class="line">  | FLOAT</span><br><span class="line">  | DOUBLE</span><br><span class="line">  | DOUBLE PRECISION -- (Note: Available in Hive 2.2.0 and later)</span><br><span class="line">  | STRING</span><br><span class="line">  | BINARY      -- (Note: Available in Hive 0.8.0 and later)</span><br><span class="line">  | TIMESTAMP   -- (Note: Available in Hive 0.8.0 and later)</span><br><span class="line">  | DECIMAL     -- (Note: Available in Hive 0.11.0 and later)</span><br><span class="line">  | DECIMAL(precision, scale)  -- (Note: Available in Hive 0.13.0 and later)</span><br><span class="line">  | DATE        -- (Note: Available in Hive 0.12.0 and later)</span><br><span class="line">  | VARCHAR     -- (Note: Available in Hive 0.12.0 and later)</span><br><span class="line">  | CHAR        -- (Note: Available in Hive 0.13.0 and later)</span><br><span class="line"> </span><br><span class="line">array_type</span><br><span class="line">  : ARRAY &lt; data_type &gt;</span><br><span class="line"> </span><br><span class="line">map_type</span><br><span class="line">  : MAP &lt; primitive_type, data_type &gt;</span><br><span class="line"> </span><br><span class="line">struct_type</span><br><span class="line">  : STRUCT &lt; col_name : data_type [COMMENT col_comment], ...&gt;</span><br><span class="line"> </span><br><span class="line">union_type</span><br><span class="line">   : UNIONTYPE &lt; data_type, data_type, ... &gt;  -- (Note: Available in Hive 0.7.0 and later)</span><br><span class="line"> </span><br><span class="line">row_format</span><br><span class="line">  : DELIMITED [FIELDS TERMINATED BY char [ESCAPED BY char]] [COLLECTION ITEMS TERMINATED BY char]</span><br><span class="line">        [MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]</span><br><span class="line">        [NULL DEFINED AS char]   -- (Note: Available in Hive 0.13 and later)</span><br><span class="line">  | SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, ...)]</span><br><span class="line"> </span><br><span class="line">file_format:</span><br><span class="line">  : SEQUENCEFILE</span><br><span class="line">  | TEXTFILE    -- (Default, depending on hive.default.fileformat configuration)</span><br><span class="line">  | RCFILE      -- (Note: Available in Hive 0.6.0 and later)</span><br><span class="line">  | ORC         -- (Note: Available in Hive 0.11.0 and later)</span><br><span class="line">  | PARQUET     -- (Note: Available in Hive 0.13.0 and later)</span><br><span class="line">  | AVRO        -- (Note: Available in Hive 0.14.0 and later)</span><br><span class="line">  | JSONFILE    -- (Note: Available in Hive 4.0.0 and later)</span><br><span class="line">  | INPUTFORMAT input_format_classname OUTPUTFORMAT output_format_classname</span><br><span class="line"> </span><br><span class="line">column_constraint_specification:</span><br><span class="line">  : [ PRIMARY KEY|UNIQUE|NOT NULL|DEFAULT [default_value]|CHECK  [check_expression] ENABLE|DISABLE NOVALIDATE RELY/NORELY ]</span><br><span class="line"> </span><br><span class="line">default_value:</span><br><span class="line">  : [ LITERAL|CURRENT_USER()|CURRENT_DATE()|CURRENT_TIMESTAMP()|NULL ] </span><br><span class="line"> </span><br><span class="line">constraint_specification:</span><br><span class="line">  : [, PRIMARY KEY (col_name, ...) DISABLE NOVALIDATE RELY/NORELY ]</span><br><span class="line">    [, PRIMARY KEY (col_name, ...) DISABLE NOVALIDATE RELY/NORELY ]</span><br><span class="line">    [, CONSTRAINT constraint_name FOREIGN KEY (col_name, ...) REFERENCES table_name(col_name, ...) DISABLE NOVALIDATE </span><br><span class="line">    [, CONSTRAINT constraint_name UNIQUE (col_name, ...) DISABLE NOVALIDATE RELY/NORELY ]</span><br><span class="line">    [, CONSTRAINT constraint_name CHECK [check_expression] ENABLE|DISABLE NOVALIDATE RELY/NORELY ]</span><br></pre></td></tr></table></figure>
<p>(ğŸ‘†æ¥è‡ªå®˜ç½‘ <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL</a><br>[] è¡¨ç¤ºå¯é€‰ï¼Œ| è¡¨ç¤ºé€‰å…¶ä¸€)</p>
<p>æ³¨ï¼š</p>
<ul>
<li>ä¸ä½¿ç”¨ EXTERNAL æ—¶ï¼Œåˆ›å»ºçš„æ˜¯å†…éƒ¨è¡¨ã€‚</li>
<li>è¡¨å’Œåˆ—çš„æ³¨é‡Šï¼ˆCOMMENTï¼‰æ˜¯å­—ç¬¦ä¸²æ–‡å­—(å•å¼•å·)ã€‚</li>
<li>è¦ä¸ºè¡¨æŒ‡å®šä¸€ä¸ªæ•°æ®åº“ï¼Œè¦ä¹ˆåœ¨<code>CREATE TABLE</code>è¯­å¥ä¹‹å‰ä½¿ç”¨<code>USE database_name</code>è¯­å¥(åœ¨Hive 0.6å’Œæ›´é«˜ç‰ˆæœ¬ä¸­)ï¼Œè¦ä¹ˆç”¨ä¸€ä¸ªæ•°æ®åº“åç§°é™å®šè¡¨å(åœ¨Hive 0.7å’Œæ›´é«˜ç‰ˆæœ¬ä¸­æ˜¯â€œdatabase _name.table.nameâ€)ã€‚</li>
<li>See <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-AlterTable" target="_blank" rel="noopener">Alter Table</a> for more information about table comments, table properties, and SerDe properties.</li>
<li>See <a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-TypeSystem" target="_blank" rel="noopener">Type System</a> and <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types" target="_blank" rel="noopener">Hive Data Types</a> for details about the primitive and complex data types.</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬é’ˆå¯¹é‡Œé¢çš„ä¸€äº›ä¸åŒäºå…³ç³»å‹æ•°æ®åº“çš„åœ°æ–¹è¿›è¡Œè¯´æ˜ã€‚</p>
<h4 id="3-1-row-format"><a href="#3-1-row-format" class="headerlink" title="3.1 row format"></a><span id="jump3.1">3.1 row format</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">row_format</span><br><span class="line">  : DELIMITED [FIELDS TERMINATED BY char [ESCAPED BY char]] [COLLECTION ITEMS TERMINATED BY char]</span><br><span class="line">        [MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char]</span><br><span class="line">        [NULL DEFINED AS char]   -- (Note: Available in Hive 0.13 and later)</span><br><span class="line">  | SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, ...)]</span><br></pre></td></tr></table></figure>
<p>Hiveå°†HDFSä¸Šçš„æ–‡ä»¶æ˜ å°„æˆè¡¨ç»“æ„ï¼Œé€šè¿‡åˆ†éš”ç¬¦æ¥åŒºåˆ†åˆ—ï¼ˆæ¯”å¦‚â€™,â€™ â€˜;â€™ or â€˜^â€™ ç­‰ï¼‰ï¼Œrow formatå°±æ˜¯ç”¨äºæŒ‡å®šåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è§„åˆ™ã€‚<br>æ¯”å¦‚å¯¹äºä»¥ä¸‹è®°å½•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1,xiaoming,book-TV-code,beijing:chaoyang-shagnhai:pudong</span><br><span class="line">2,lilei,book-code,nanjing:jiangning-taiwan:taibei</span><br><span class="line">3,lihua,music-book,heilongjiang:haerbin</span><br></pre></td></tr></table></figure>
<p><strong>é€—å·</strong>ç”¨äºåˆ†å‰²åˆ—ï¼Œå³FIELDS TERMINATED BY charï¼Œåˆ†å‰²ä¸ºå¦‚ä¸‹åˆ— <strong>ID</strong>ã€<strong>name</strong>ã€<strong>hobby</strong>ï¼ˆè¯¥å­—æ®µæ˜¯æ•°ç»„å½¢å¼ï¼Œé€šè¿‡ â€˜-â€™ è¿›è¡Œåˆ†å‰²ï¼Œå³COLLECTION ITEMS TERMINATED BY â€˜-â€™ï¼‰ã€<strong>address</strong>ï¼ˆè¯¥å­—æ®µæ˜¯é”®å€¼å¯¹å½¢å¼mapï¼Œé€šè¿‡ â€˜:â€™ åˆ†å‰²é”®å€¼ï¼Œå³ MAP KEYS TERMINATED BY â€˜:â€™ï¼‰ï¼›<br>è€ŒFIELDS TERMINATED BY charç”¨äºåŒºåˆ†ä¸åŒæ¡çš„æ•°æ®ï¼Œé»˜è®¤æ˜¯æ¢è¡Œç¬¦ï¼›</p>
<h4 id="3-2-file-formatï¼ˆHDFSæ–‡ä»¶å­˜æ”¾çš„æ ¼å¼ï¼‰"><a href="#3-2-file-formatï¼ˆHDFSæ–‡ä»¶å­˜æ”¾çš„æ ¼å¼ï¼‰" class="headerlink" title="3.2 file formatï¼ˆHDFSæ–‡ä»¶å­˜æ”¾çš„æ ¼å¼ï¼‰"></a>3.2 file formatï¼ˆHDFSæ–‡ä»¶å­˜æ”¾çš„æ ¼å¼ï¼‰</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">file_format:</span><br><span class="line">  : SEQUENCEFILE</span><br><span class="line">  | TEXTFILE    -- (Default, depending on hive.default.fileformat configuration)</span><br><span class="line">  | RCFILE      -- (Note: Available in Hive 0.6.0 and later)</span><br><span class="line">  | ORC         -- (Note: Available in Hive 0.11.0 and later)</span><br><span class="line">  | PARQUET     -- (Note: Available in Hive 0.13.0 and later)</span><br><span class="line">  | AVRO        -- (Note: Available in Hive 0.14.0 and later)</span><br><span class="line">  | JSONFILE    -- (Note: Available in Hive 4.0.0 and later)</span><br><span class="line">  | INPUTFORMAT input_format_classname OUTPUTFORMAT output_format_classname</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤TEXTFILEï¼Œå³æ–‡æœ¬æ ¼å¼ï¼Œå¯ä»¥ç›´æ¥æ‰“å¼€ã€‚</p>
<h4 id="3-3-å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨"><a href="#3-3-å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨" class="headerlink" title="3.3 å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨"></a><span id="jump3.3">3.3 å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨</span></h4><p>å…³äºå†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨çš„æ›´å¤šå†…å®¹è§ <a href="#jump4.1">4.1 å†…éƒ¨è¡¨</a>ä¸ <a href="#jump4.2">4.2 å¤–éƒ¨è¡¨</a></p>
<p>ä¸ä½¿ç”¨EXTERNALå­å¥åˆ›å»ºçš„è¡¨ç§°ä¸ºç®¡ç†è¡¨ (ä¹Ÿå«åšå†…éƒ¨è¡¨) (managed table)ï¼Œå› ä¸ºHiveç®¡ç†å®ƒçš„æ•°æ®ã€‚è‹¥è¦ç¡®å®šä¸€ä¸ªè¡¨æ˜¯ç®¡ç†è¡¨è¿˜æ˜¯å¤–éƒ¨è¡¨ï¼Œä½¿ç”¨ <a href="https://cwiki.apache.org/confluence/display/Hive/Managed+vs.+External+Tables#Managedvs.ExternalTables-DescribeTable/View/Column" target="_blank" rel="noopener">DESCRIBE FORMATTED table_name</a> command, which will display either MANAGED_TABLE or EXTERNAL_TABLE depending on table type.</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHiveåˆ›å»ºç®¡ç†è¡¨ï¼Œå…¶ä¸­æ–‡ä»¶ã€å…ƒæ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯ç”±å†…éƒ¨Hiveè¿›ç¨‹ç®¡ç† (By default Hive creates managed tables, where files, metadata and statistics are managed by internal Hive processes)ã€‚ æœ‰å…³ç®¡ç†è¡¨ä¸å¤–éƒ¨è¡¨ä¹‹é—´å·®å¼‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://cwiki.apache.org/confluence/display/Hive/Managed+vs.+External+Tables" target="_blank" rel="noopener">Managed vs. External Tables</a>ã€‚</p>
<h5 id="Feature-comparison"><a href="#Feature-comparison" class="headerlink" title="Feature comparison"></a>Feature comparison</h5><ul>
<li>ARCHIVE/UNARCHIVE/TRUNCATE/MERGE/CONCATENATE only work for managed tables</li>
<li>DROP deletes data for managed tables while it only deletes metadata for external ones</li>
<li>ACID/Transactional only works for managed tables</li>
<li><a href="https://issues.apache.org/jira/browse/HIVE-18513" target="_blank" rel="noopener">Query Results Caching</a> only works for managed tables</li>
<li>Only the RELY constraint is allowed on external tables</li>
<li>Some Materialized View features only work on managed tables</li>
</ul>
<h5 id="Managed-tables-å†…éƒ¨è¡¨"><a href="#Managed-tables-å†…éƒ¨è¡¨" class="headerlink" title="Managed tables å†…éƒ¨è¡¨"></a>Managed tables å†…éƒ¨è¡¨</h5><p>A managed table is stored under the <a href="https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.metastore.warehouse.dir" target="_blank" rel="noopener">hive.metastore.warehouse.dir</a> path property, by default in a folder path similar to <code>/user/hive/warehouse/databasename.db/tablename/</code>. The default location can be overridden by the <code>location</code> property during table creation. If a managed table or partition is dropped, the data and metadata associated with that table or partition are deleted. If the PURGE option is not specified, the data is moved to a trash folder for a defined duration.</p>
<p><span style="color:red">Use managed tables when Hive should manage the lifecycle of the table, or when generating temporary tables.</span></p>
<p>ç®¡ç†è¡¨çš„ä¸»è¦é—®é¢˜æ˜¯åªèƒ½ç”¨ Hive è®¿é—®ï¼Œä¸æ–¹ä¾¿å’Œå…¶ä»–ç³»ç»Ÿå…±äº«æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä»½ç”± Pig æˆ–å…¶ä»–å·¥å…·åˆ›å»ºå¹¶ä¸”ä¸»è¦ç”±è¿™ä¸€å·¥å…·ä½¿ç”¨çš„æ•°æ®ï¼ŒåŒæ—¶å¸Œæœ›ä½¿ç”¨ Hive åœ¨è¿™ä»½æ•°æ®ä¸Šæ‰§è¡Œä¸€äº›æŸ¥è¯¢ï¼Œå¯æ˜¯å¹¶æ²¡æœ‰ç»™äºˆ Hive å¯¹æ•°æ®çš„æ‰€æœ‰æƒï¼Œè¿™æ—¶å°±ä¸èƒ½ä½¿ç”¨ç®¡ç†è¡¨äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è¡¨æŒ‡å‘è¿™ä»½æ•°æ®ï¼Œè€Œå¹¶ä¸éœ€è¦å¯¹å…¶å…·æœ‰æ‰€æœ‰æƒã€‚</p>
<h5 id="External-tables-å¤–éƒ¨è¡¨"><a href="#External-tables-å¤–éƒ¨è¡¨" class="headerlink" title="External tables å¤–éƒ¨è¡¨"></a>External tables å¤–éƒ¨è¡¨</h5><p>An external table describes the metadata / schema on external files. External table files can be accessed and managed by processes outside of Hive. External tables can access data stored in sources such as Azure Storage Volumes (ASV) or remote HDFS locations. If the structure or partitioning of an external table is changed, an <a href="https://cwiki.apache.org/confluence/display/Hive/Managed+vs.+External+Tables#Managedvs.ExternalTables-RecoverPartitions(MSCKREPAIRTABLE" target="_blank" rel="noopener">MSCK REPAIR TABLE table_name</a>) statement can be used to refresh metadata information.</p>
<p><span style="color:red">Use external tables when files are already present or in remote locations, and the files should remain even if the table is dropped.</span></p>
<p>å¤–éƒ¨è¡¨æ–¹ä¾¿å¯¹å·²æœ‰æ•°æ®çš„é›†æˆã€‚å› ä¸ºè¡¨æ˜¯å¤–éƒ¨çš„ï¼Œæ‰€ä»¥ Hive å¹¶ä¸è®¤ä¸ºå…¶å®Œå…¨æ‹¥æœ‰è¿™ä¸ªè¡¨çš„æ•°æ®ã€‚åœ¨å¯¹å¤–éƒ¨è¡¨æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶ï¼Œåªæ˜¯åˆ é™¤æ‰æè¿°è¡¨çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶ä¸ä¼šåˆ é™¤è¡¨æ•°æ®ã€‚</p>
<h5 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h5><ul>
<li>å†…éƒ¨è¡¨æ•°æ®ç”±Hiveè‡ªèº«ç®¡ç†ï¼Œå¤–éƒ¨è¡¨æ•°æ®ç”±HDFSç®¡ç†ï¼›</li>
<li>å†…éƒ¨è¡¨æ•°æ®å­˜å‚¨çš„ä½ç½®æ˜¯hive.metastore.warehouse.dirï¼ˆé»˜è®¤ï¼š/user/hive/warehouseï¼‰ï¼Œå¤–éƒ¨è¡¨æ•°æ®çš„å­˜å‚¨ä½ç½®ç”±è‡ªå·±åˆ¶å®šï¼›</li>
<li>åˆ é™¤å†…éƒ¨è¡¨ä¼šç›´æ¥åˆ é™¤å…ƒæ•°æ®ï¼ˆmetadataï¼‰åŠå­˜å‚¨æ•°æ®ï¼›åˆ é™¤å¤–éƒ¨è¡¨ä»…ä»…ä¼šåˆ é™¤å…ƒæ•°æ®ï¼ŒHDFSä¸Šçš„æ–‡ä»¶å¹¶ä¸ä¼šè¢«åˆ é™¤ï¼›</li>
<li>å¯¹å†…éƒ¨è¡¨çš„ä¿®æ”¹ä¼šå°†ä¿®æ”¹ç›´æ¥åŒæ­¥ç»™å…ƒæ•°æ®ï¼Œè€Œå¯¹å¤–éƒ¨è¡¨çš„è¡¨ç»“æ„å’Œåˆ†åŒºè¿›è¡Œä¿®æ”¹ï¼Œåˆ™éœ€è¦ä¿®å¤ï¼ˆMSCK REPAIR TABLE table_name;ï¼‰</li>
</ul>
<h4 id="3-4-Partitioned-Tables"><a href="#3-4-Partitioned-Tables" class="headerlink" title="3.4 Partitioned Tables"></a><span id="jump3.4">3.4 Partitioned Tables</span></h4><p>å¦å¤–å…³äºåˆ†åŒºè¡¨çš„å†…å®¹è§ <a href="#jump4.4">4.4 åˆ†åŒºè¡¨ï¼ˆPartitioned Tablesï¼‰</a></p>
<p>å¯ä»¥ä½¿ç”¨ PARTITIONED BY å­å¥åˆ›å»ºåˆ†åŒºè¡¨ã€‚ ä¸€ä¸ªè¡¨å¯ä»¥å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºåˆ—ï¼Œå¹¶ä¸ºåˆ†åŒºåˆ—ä¸­çš„æ¯ä¸ªä¸åŒå€¼ç»„åˆåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ•°æ®ç›®å½•ã€‚ æ­¤å¤–ï¼Œå¯ä»¥ä½¿ç”¨CLUSTERED BYåˆ—å¯¹è¡¨æˆ–åˆ†åŒºè¿›è¡Œå­˜å‚¨ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡SORT BYåˆ—åœ¨è¯¥å­˜å‚¨åŒºä¸­å¯¹æ•°æ®è¿›è¡Œæ’åºï¼ˆtables or partitions can be bucketed using CLUSTERED BY columns, and data can be sorted within that bucket via SORT BY columns. ï¼‰ã€‚ è¿™æ ·å¯ä»¥æé«˜æŸäº›æŸ¥è¯¢çš„æ€§èƒ½ã€‚</p>
<blockquote>
<p>æ›´å¤šå…³äºbucket çš„å†…å®¹è§ <a href="#jump4.5">4.5 åˆ†æ¡¶è¡¨ï¼ˆBucket Tablesï¼‰ </a></p>
</blockquote>
<p>å¦‚æœåœ¨åˆ›å»ºåˆ†åŒºè¡¨æ—¶æ”¶åˆ°ä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼šâ€œ FAILED: Error in semantic analysis: Column repeated in partitioning columnsâ€ï¼Œåˆ™è¡¨ç¤ºæ‚¨è¯•å›¾å°†åˆ†åŒºåˆ—åŒ…å«åœ¨è¡¨æœ¬èº«çš„æ•°æ®ä¸­ã€‚ æ‚¨å¯èƒ½ç¡®å®å®šä¹‰äº†è¯¥åˆ—ã€‚ ä½†æ˜¯ï¼Œæ‚¨åˆ›å»ºçš„åˆ†åŒºå°†åˆ›å»ºä¸€ä¸ªå¯æŸ¥è¯¢çš„ä¼ªåˆ—ï¼Œå› æ­¤æ‚¨å¿…é¡»å°†è¡¨åˆ—é‡å‘½åä¸ºå…¶ä»–åç§°ï¼ˆç”¨æˆ·ä¸åº”åœ¨å…¶ä¸ŠæŸ¥è¯¢ï¼ï¼‰ã€‚</p>
<p>(You probably really do have the column defined. However, the partition you create makes a pseudocolumn on which you can query, so you must rename your table column to something else (that users should not query on!).)</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾åŸå§‹æœªåˆ†åŒºè¡¨å…·æœ‰ä¸‰åˆ—ï¼šidï¼Œdateå’Œnameã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id int,</span><br><span class="line">date date,</span><br><span class="line">name varchar</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æ‚¨è¦æŒ‰æ—¥æœŸåˆ†åŒºã€‚ æ‚¨çš„Hiveå®šä¹‰å¯ä»¥ä½¿ç”¨â€œ dtDontQueryâ€ä½œä¸ºåˆ—åï¼Œä»¥ä¾¿å¯ä»¥å°†â€œ dateâ€ç”¨äºåˆ†åŒºï¼ˆå’ŒæŸ¥è¯¢ï¼‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table table_name ( </span><br><span class="line">	id int,</span><br><span class="line">	dtDontQuery string,</span><br><span class="line">	name string</span><br><span class="line">)</span><br><span class="line">partitioned by (date string)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæ‚¨çš„ç”¨æˆ·ä»å°†æŸ¥è¯¢<code>where date =&#39;...&#39;</code>ï¼Œä½†ç¬¬äºŒåˆ—dtDontQueryå°†ä¿ç•™åŸå§‹å€¼ã€‚</p>
<h4 id="3-5-æ³•ä¸€ï¼šç›´æ¥å»ºè¡¨æ³•"><a href="#3-5-æ³•ä¸€ï¼šç›´æ¥å»ºè¡¨æ³•" class="headerlink" title="3.5 æ³•ä¸€ï¼šç›´æ¥å»ºè¡¨æ³•"></a>3.5 æ³•ä¸€ï¼šç›´æ¥å»ºè¡¨æ³•</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> table_name(col_name data_type);</span><br></pre></td></tr></table></figure>
<h5 id="3-5-1-ä¾‹å­ï¼šåˆ›å»ºå†…éƒ¨è¡¨"><a href="#3-5-1-ä¾‹å­ï¼šåˆ›å»ºå†…éƒ¨è¡¨" class="headerlink" title="3.5.1 ä¾‹å­ï¼šåˆ›å»ºå†…éƒ¨è¡¨"></a>3.5.1 ä¾‹å­ï¼šåˆ›å»ºå†…éƒ¨è¡¨</h5><p>å¦‚ä¸‹ï¼šæ ¹æ®ä¸Šè¿°æ–‡ä»¶å†…å®¹(è§<a href="#jump3.1">3.1 row format</a>)ï¼Œåˆ›å»ºä¸€ä¸ªè¡¨t1</p>
<h6 id="1-åˆ›å»ºè¡¨"><a href="#1-åˆ›å»ºè¡¨" class="headerlink" title="1. åˆ›å»ºè¡¨"></a>1. åˆ›å»ºè¡¨</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1(</span><br><span class="line">    <span class="keyword">id</span>      <span class="built_in">int</span>,</span><br><span class="line">    <span class="keyword">name</span>    <span class="keyword">string</span>,</span><br><span class="line">    hobby   <span class="built_in">array</span>&lt;<span class="keyword">string</span>&gt;,</span><br><span class="line">    <span class="keyword">add</span>     <span class="keyword">map</span>&lt;<span class="keyword">String</span>,<span class="keyword">string</span>&gt;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'-'</span></span><br><span class="line"><span class="keyword">map</span> <span class="keyword">keys</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">':'</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p> <img src="/2020/01/12/Hiveä»‹ç»/1603599880662.png" alt="1603599880662"></p>
<h6 id="2-æŸ¥çœ‹è¡¨çš„æè¿°"><a href="#2-æŸ¥çœ‹è¡¨çš„æè¿°" class="headerlink" title="2.æŸ¥çœ‹è¡¨çš„æè¿°"></a>2.æŸ¥çœ‹è¡¨çš„æè¿°</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc t1;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603599824805.png" alt="1603599824805"></p>
<h6 id="3-æ’å…¥æ•°æ®"><a href="#3-æ’å…¥æ•°æ®" class="headerlink" title="3. æ’å…¥æ•°æ®"></a><span id="jump3.5.1.3">3. æ’å…¥æ•°æ®</span></h6><p>æ³¨ï¼šä¸€èˆ¬å¾ˆå°‘ç”¨insert ï¼ˆä¸æ˜¯insert overwriteï¼‰è¯­å¥ï¼Œå› ä¸ºå°±ç®—å°±ç®—æ’å…¥ä¸€æ¡æ•°æ®ï¼Œä¹Ÿä¼šè°ƒç”¨MapReduceï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©Load Dataçš„æ–¹å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA [LOCAL] INPATH &apos;filepath&apos; [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]</span><br></pre></td></tr></table></figure>
<p>Hive 3.0ä¹‹å‰çš„åŠ è½½æ“ä½œæ˜¯çº¯å¤åˆ¶/ç§»åŠ¨æ“ä½œï¼Œå°†æ•°æ®æ–‡ä»¶ç§»åŠ¨åˆ°ä¸Hiveè¡¨ç›¸å¯¹åº”çš„ä½ç½®</p>
<ul>
<li><em>filepath</em> can be:<ul>
<li>a relative path, such as project/data1</li>
<li>an absolute path, such as /user/hive/project/data1</li>
<li>a full URI with scheme and (optionally) an authority, such as hdfs://namenode:9000/user/hive/project/data1</li>
</ul>
</li>
<li>The target being loaded to can be a table or a partition. If the table is partitioned, then one must specify a specific partition of the table by specifying values for all of the partitioning columns.</li>
<li><em>filepath</em> å¯ä»¥æŒ‡å‘æ–‡ä»¶ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHiveä¼šå°†æ–‡ä»¶ç§»è‡³è¡¨ä¸­ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›®å½•ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHiveä¼šå°†ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ç§»è‡³è¡¨ä¸­ï¼‰ã€‚ In either case, <em>filepath</em> addresses a set of files.</li>
<li>å¦‚æœæŒ‡å®šäº†å…³é”®å­— LOCALï¼Œåˆ™<ul>
<li>loadå‘½ä»¤å°†åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æŸ¥æ‰¾æ–‡ä»¶è·¯å¾„ã€‚ å¦‚æœæŒ‡å®šçš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå®ƒå°†ç›¸å¯¹äºç”¨æˆ·çš„å½“å‰å·¥ä½œç›®å½•è¿›è¡Œè§£é‡Šã€‚ ç”¨æˆ·ä¹Ÿå¯ä»¥ä¸ºæœ¬åœ°æ–‡ä»¶æŒ‡å®šå®Œæ•´çš„URI - for example: <code>file:///user/hive/project/data1</code></li>
<li>the load command will try to copy all the files addressed by <em>filepath</em> to the target filesystem. The target file system is inferred by looking at the location attribute of the table. The copied data files will then be moved to the table.</li>
</ul>
</li>
<li>å¦‚æœæœªæŒ‡å®šå…³é”®å­— LOCALï¼Œåˆ™Hiveå°†ä½¿ç”¨æ–‡ä»¶è·¯å¾„çš„å®Œæ•´URIï¼ˆå¦‚æœå·²æŒ‡å®šï¼‰ï¼Œæˆ–å°†åº”ç”¨ä»¥ä¸‹è§„åˆ™ï¼š<ul>
<li>If scheme or authority are not specified, Hive will use the scheme and authority from the hadoop configuration variable <code>fs.default.name</code> that specifies the Namenode URI.</li>
<li>If the path is not absolute, then Hive will interpret it relative to <code>/user/&lt;username&gt;</code></li>
<li>Hive will <em>move</em> the files addressed by <em>filepath</em> into the table (or partition)</li>
</ul>
</li>
<li>å¦‚æœä½¿ç”¨äº† OVERWRITE å…³é”®å­—ï¼Œthen the contents of the target table (or partition) will be deleted and replaced by the files referred to by filepathï¼› å¦åˆ™ï¼ŒfilepathæŒ‡å‘çš„æ–‡ä»¶å°†è¢«æ·»åŠ åˆ°è¡¨ä¸­ã€‚</li>
</ul>
<p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç²˜è´´ä¸Šè¿°è®°å½•ï¼Œå¹¶ä¸Šè½½å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603600131112.png" alt="1603600131112"></p>
<p>ç„¶åä¸Šè½½</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &apos;/home/hadoop/Desktop/data&apos; overwrite into table t1;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹è¡¨å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603600188322.png" alt="1603600188322"></p>
<h6 id="4-æŸ¥çœ‹æ–‡ä»¶ä½ç½®"><a href="#4-æŸ¥çœ‹æ–‡ä»¶ä½ç½®" class="headerlink" title="4. æŸ¥çœ‹æ–‡ä»¶ä½ç½®"></a>4. æŸ¥çœ‹æ–‡ä»¶ä½ç½®</h6><p>t1è¡¨åœ¨å“ªå„¿å‘¢ï¼Ÿåœ¨æˆ‘ä»¬ä¹‹å‰é…ç½®çš„é»˜è®¤è·¯å¾„é‡Œï¼ˆ/user/hive/warehouseï¼‰</p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603609902727.png" alt="1603609902727"></p>
<p>é€šè¿‡å‘½ä»¤è¡Œè·å–ä½ç½®ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc formatted table_name;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603610044780.png" alt="1603610044780"></p>
<h6 id="5-åˆ é™¤å†…éƒ¨è¡¨"><a href="#5-åˆ é™¤å†…éƒ¨è¡¨" class="headerlink" title="5. åˆ é™¤å†…éƒ¨è¡¨"></a>5. åˆ é™¤å†…éƒ¨è¡¨</h6><p><img src="/2020/01/12/Hiveä»‹ç»/1603610161316.png" alt="1603610161316"></p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603610193337.png" alt="1603610193337"></p>
<p>è§‚å¯ŸHDFSä¸Šçš„æ–‡ä»¶ï¼Œå‘ç°t1å·²ç»ä¸åœ¨äº†</p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603610402205.png" alt="1603610402205"></p>
<ul>
<li></li>
</ul>
<h5 id="3-5-2-ä¾‹å­ï¼šåˆ›å»ºå¤–éƒ¨è¡¨"><a href="#3-5-2-ä¾‹å­ï¼šåˆ›å»ºå¤–éƒ¨è¡¨" class="headerlink" title="3.5.2 ä¾‹å­ï¼šåˆ›å»ºå¤–éƒ¨è¡¨"></a>3.5.2 ä¾‹å­ï¼šåˆ›å»ºå¤–éƒ¨è¡¨</h5><h6 id="1-åˆ›å»ºè¡¨-1"><a href="#1-åˆ›å»ºè¡¨-1" class="headerlink" title="1. åˆ›å»ºè¡¨"></a>1. åˆ›å»ºè¡¨</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> t2(</span><br><span class="line">    <span class="keyword">id</span>      <span class="built_in">int</span></span><br><span class="line">   ,<span class="keyword">name</span>    <span class="keyword">string</span></span><br><span class="line">   ,hobby   <span class="built_in">array</span>&lt;<span class="keyword">string</span>&gt;</span><br><span class="line">   ,<span class="keyword">add</span>     <span class="keyword">map</span>&lt;<span class="keyword">String</span>,<span class="keyword">string</span>&gt;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'-'</span></span><br><span class="line"><span class="keyword">map</span> <span class="keyword">keys</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">':'</span></span><br><span class="line">location <span class="string">'/user/t2'</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603600496450.png" alt="1603600496450"></p>
<h6 id="2-è£…è½½æ•°æ®"><a href="#2-è£…è½½æ•°æ®" class="headerlink" title="2. è£…è½½æ•°æ®"></a>2. è£…è½½æ•°æ®</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &apos;/home/hadoop/Desktop/data&apos; overwrite into table t2;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603600549196.png" alt="1603600549196"></p>
<h6 id="3-æŸ¥çœ‹æ–‡ä»¶ä½ç½®"><a href="#3-æŸ¥çœ‹æ–‡ä»¶ä½ç½®" class="headerlink" title="3. æŸ¥çœ‹æ–‡ä»¶ä½ç½®"></a>3. æŸ¥çœ‹æ–‡ä»¶ä½ç½®</h6><p>åœ¨/user/ç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°t2æ–‡ä»¶</p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603609992170.png" alt="1603609992170"></p>
<p>é€šè¿‡å‘½ä»¤è¡Œè·å¾—ä½ç½®ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc formatted table_name;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603610068333.png" alt="1603610068333"></p>
<h6 id="4-åˆ é™¤å¤–éƒ¨è¡¨"><a href="#4-åˆ é™¤å¤–éƒ¨è¡¨" class="headerlink" title="4. åˆ é™¤å¤–éƒ¨è¡¨"></a>4. åˆ é™¤å¤–éƒ¨è¡¨</h6><p><img src="/2020/01/12/Hiveä»‹ç»/1603610449476.png" alt="1603610449476"></p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603610471246.png" alt="1603610471246"></p>
<p>è§‚å¯ŸHDFSä¸Šçš„æ–‡ä»¶ï¼Œt2ä»ç„¶å­˜åœ¨</p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603610518016.png" alt="1603610518016"></p>
<p>å› è€Œåˆ é™¤å¤–éƒ¨è¡¨ä»…ä»…ä¼šåˆ é™¤å…ƒæ•°æ®ã€‚</p>
<p>é‡æ–°åˆ›å»ºå¤–éƒ¨è¡¨t2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create external table t2(</span><br><span class="line">    id      int</span><br><span class="line">   ,name    string</span><br><span class="line">   ,hobby   array&lt;string&gt;</span><br><span class="line">   ,add     map&lt;String,string&gt;</span><br><span class="line">)</span><br><span class="line">row format delimited</span><br><span class="line">fields terminated by &apos;,&apos;</span><br><span class="line">collection items terminated by &apos;-&apos;</span><br><span class="line">map keys terminated by &apos;:&apos;</span><br><span class="line">location &apos;/user/t2&apos;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603610616445.png" alt="1603610616445"></p>
<p>ä¸å¾€é‡Œé¢æ’å…¥æ•°æ®ï¼Œæˆ‘ä»¬select * çœ‹çœ‹ç»“æœ</p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603610644871.png" alt="1603610644871"></p>
<p>å¯è§æ•°æ®ä»ç„¶åœ¨ï¼</p>
<h4 id="3-6-æ³•äºŒï¼šæŸ¥è¯¢å»ºè¡¨æ³•ï¼ˆCreate-Table-As-Select-CTAS-ï¼‰"><a href="#3-6-æ³•äºŒï¼šæŸ¥è¯¢å»ºè¡¨æ³•ï¼ˆCreate-Table-As-Select-CTAS-ï¼‰" class="headerlink" title="3.6 æ³•äºŒï¼šæŸ¥è¯¢å»ºè¡¨æ³•ï¼ˆCreate Table As Select (CTAS)ï¼‰"></a>3.6 æ³•äºŒï¼šæŸ¥è¯¢å»ºè¡¨æ³•ï¼ˆCreate Table As Select (CTAS)ï¼‰</h4><p>é€šè¿‡AS æŸ¥è¯¢è¯­å¥å®Œæˆå»ºè¡¨ï¼š<strong>å°†å­æŸ¥è¯¢çš„ç»“æœå­˜åœ¨æ–°è¡¨é‡Œï¼Œæœ‰æ•°æ®</strong><br>ä¸€èˆ¬ç”¨äºä¸­é—´è¡¨ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä¸€ä¸ªcreate-table-as-selectï¼ˆCTASï¼‰è¯­å¥ä¸­çš„æŸ¥è¯¢ç»“æœæ¥åˆ›å»ºå’Œå¡«å……è¡¨ã€‚ CTASåˆ›å»ºçš„è¡¨æ˜¯åŸå­è¡¨ï¼Œè¿™æ„å‘³ç€åœ¨å¡«å……æ‰€æœ‰æŸ¥è¯¢ç»“æœä¹‹å‰ï¼Œå…¶ä»–ç”¨æˆ·ä¸ä¼šçœ‹åˆ°è¯¥è¡¨ã€‚å› æ­¤ï¼Œå…¶ä»–ç”¨æˆ·è¦ä¹ˆçœ‹åˆ°åŒ…å«å®Œæ•´æŸ¥è¯¢ç»“æœçš„è¡¨ï¼Œè¦ä¹ˆæ ¹æœ¬çœ‹ä¸åˆ°è¡¨ã€‚</p>
<p>CTASæœ‰ä¸¤éƒ¨åˆ†ï¼ŒSELECTéƒ¨åˆ†å¯ä»¥æ˜¯HiveQLæ”¯æŒçš„ä»»ä½•SELECTè¯­å¥ ( <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select" target="_blank" rel="noopener">SELECT statement</a>)ï¼› CREATEéƒ¨åˆ†ä»SELECTéƒ¨åˆ†è·å–ç»“æœæ¨¡å¼ï¼Œå¹¶ä½¿ç”¨å…¶ä»–è¡¨å±æ€§ï¼ˆä¾‹å¦‚SerDeå’Œå­˜å‚¨æ ¼å¼ï¼‰åˆ›å»º<strong>ç›®æ ‡è¡¨</strong>ã€‚( The CREATE part of the CTAS takes the resulting schema from the SELECT part and creates the target table with other table properties such as the SerDe and storage format.)</p>
<p>ä»Hive 3.2.0å¼€å§‹ï¼ŒCTASè¯­å¥å¯ä»¥ä¸ºç›®æ ‡è¡¨å®šä¹‰åˆ†åŒºè§„èŒƒã€‚(can define a partitioning specification for the target table (<a href="https://issues.apache.org/jira/browse/HIVE-20241" target="_blank" rel="noopener">HIVE-20241</a>)).</p>
<p>CTASå…·æœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p>
<ul>
<li><p>ç›®æ ‡è¡¨ä¸èƒ½æ˜¯å¤–éƒ¨è¡¨ã€‚</p>
</li>
<li><p>ç›®æ ‡è¡¨ä¸èƒ½æ˜¯åˆ—è¡¨å­˜å‚¨è¡¨ (list bucketing table)ã€‚</p>
</li>
</ul>
<p>ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE new_key_value_store</span><br><span class="line">   ROW FORMAT SERDE &quot;org.apache.hadoop.hive.serde2.columnar.ColumnarSerDe&quot;</span><br><span class="line">   STORED AS RCFile</span><br><span class="line">   AS</span><br><span class="line">SELECT (key % 1024) new_key, concat(key, value) key_value_pair</span><br><span class="line">FROM key_value_store</span><br><span class="line">SORT BY new_key, key_value_pair;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„CTASè¯­å¥ä½¿ç”¨ä»SELECTè¯­å¥ç»“æœå¾—åˆ°çš„schemaï¼ˆnew_key DOUBLEï¼Œkey_value_pair STRINGï¼‰åˆ›å»ºç›®æ ‡è¡¨new_key_value_storeã€‚å¦‚æœSELECTè¯­å¥æœªæŒ‡å®šåˆ—åˆ«åï¼Œåˆ™åˆ—åå°†è‡ªåŠ¨åˆ†é…ç»™_col0ï¼Œ_col1å’Œ_col2ç­‰ã€‚æ­¤å¤–ï¼Œæ–°ç›®æ ‡è¡¨æ˜¯ä½¿ç”¨ç‰¹å®šçš„SerDeå’Œå­˜å‚¨æ ¼å¼åˆ›å»ºçš„ï¼Œç‹¬ç«‹äºthe source tables in the SELECT statement.</p>
<p>Starting with <a href="https://issues.apache.org/jira/browse/HIVE-1180" target="_blank" rel="noopener">Hive 0.13.0</a>, the SELECT statement can include one or more common table expressions (CTEs), as shown in the <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select#LanguageManualSelect-SelectSyntax" target="_blank" rel="noopener">SELECT syntax</a>. For an example, see <a href="https://cwiki.apache.org/confluence/display/Hive/Common+Table+Expression#CommonTableExpression-CTEinViews,CTAS,andInsertStatements" target="_blank" rel="noopener">Common Table Expression</a>.</p>
<p>èƒ½å¤Ÿ<strong>ä»ä¸€ä¸ªè¡¨é€‰æ‹©æ•°æ®åˆ°å¦ä¸€ä¸ªè¡¨</strong>æ˜¯Hiveæœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ã€‚Hiveåœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶å¤„ç†æ•°æ®ä»æºæ ¼å¼åˆ°ç›®æ ‡æ ¼å¼çš„è½¬æ¢ã€‚(Being able to select data from one table to another is one of the most powerful features of Hive. Hive handles the conversion of the data from the source format to the destination format as the query is being executed.)</p>
<p>æ ¹æ®ä¾‹å­æˆ‘ä»¬å»ºä¸€å¼ è¡¨ï¼št3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table t3 as</span><br><span class="line">select</span><br><span class="line">    id,</span><br><span class="line">    name</span><br><span class="line">from t2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>ä¼šæ‰§è¡ŒMapReduceè¿‡ç¨‹ã€‚<br>æŸ¥çœ‹è¡¨ç»“æ„åŠå†…å®¹ï¼Œå‘ç°æ˜¯æœ‰æ•°æ®çš„ï¼Œå¹¶ä¸”ç”±äºæ²¡æœ‰æŒ‡å®šå¤–éƒ¨è¡¨å’Œlocationï¼Œè¯¥è¡¨åœ¨é»˜è®¤ä½ç½®ï¼Œå³æ˜¯å†…éƒ¨è¡¨ã€‚</p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603613699566.png" alt="1603613699566"></p>
<h4 id="3-7-æ³•ä¸‰ï¼šlikeå»ºè¡¨æ³•"><a href="#3-7-æ³•ä¸‰ï¼šlikeå»ºè¡¨æ³•" class="headerlink" title="3.7 æ³•ä¸‰ï¼šlikeå»ºè¡¨æ³•"></a>3.7 æ³•ä¸‰ï¼šlikeå»ºè¡¨æ³•</h4><p><strong>ä¼šåˆ›å»ºç»“æ„å®Œå…¨ç›¸åŒçš„è¡¨ï¼Œä½†æ˜¯æ²¡æœ‰æ•°æ®ã€‚</strong><br>å¸¸ç”¨äºä¸­é—´è¡¨.</p>
<p>LIKEå½¢å¼çš„CREATE TABLEå…è®¸æ‚¨ç²¾ç¡®åœ°<strong> </strong>ã€‚(The LIKE form of CREATE TABLE allows you to copy an existing table definition exactly (without copying its data). )</p>
<p>ä¸CTASç›¸æ¯”ï¼Œä»¥ä¸‹è¯­å¥åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„empty_key_value_storeè¡¨ï¼Œå®ƒçš„å®šä¹‰åœ¨è¡¨åä»¥å¤–çš„æ‰€æœ‰ç»†èŠ‚ä¸Šä¸ç°æœ‰key_value_storeå®Œå…¨åŒ¹é…ã€‚ æ–°è¡¨ä¸åŒ…å«ä»»ä½•è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE empty_key_value_store</span><br><span class="line">LIKE key_value_store [TBLPROPERTIES (property_name=property_value, ...)];</span><br></pre></td></tr></table></figure>
<p>åœ¨Hive 0.8.0ä¹‹å‰ï¼ŒCREATE TABLE LIKE view_nameå°†å¤åˆ¶è¯¥è§†å›¾ã€‚ åœ¨Hive 0.8.0å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒCREATE TABLE LIKE view_nameé€šè¿‡ä½¿ç”¨view_name schemaï¼ˆå­—æ®µ(fields)å’Œåˆ†åŒºåˆ—(partition columns)ï¼‰, ä½¿ç”¨SerDeå’Œæ–‡ä»¶æ ¼å¼çš„é»˜è®¤å€¼æ¥åˆ›å»ºä¸€ä¸ªè¡¨ã€‚</p>
<p>æ³¨ï¼šä¸Šé¢è¯­å¥ä¸­å¦‚æœä¸ä½¿ç”¨ EXTERNAL å…³é”®å­—ï¼Œè‹¥æºè¡¨æ˜¯å¤–éƒ¨è¡¨çš„è¯ï¼Œç”Ÿæˆçš„æ–°è¡¨ä¹Ÿå°†æ˜¯å¤–éƒ¨è¡¨ï¼›è‹¥æºè¡¨æ˜¯å†…éƒ¨è¡¨çš„è¯ï¼Œç”Ÿæˆçš„æ–°è¡¨ä¹Ÿå°†æ˜¯å†…éƒ¨è¡¨ã€‚è‹¥è¯­å¥ä¸­åŒ…å« EXTERNAL å…³é”®å­—ä¸”æºè¡¨æ˜¯å†…éƒ¨è¡¨çš„è¯ï¼Œç”Ÿæˆçš„æ–°è¡¨å°†æ˜¯å¤–éƒ¨è¡¨ã€‚å³ä½¿åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼ŒLOCATION å­å¥åŒæ ·æ˜¯å¯é€‰çš„ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table t4 like t2;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œä¸ä¼šæ‰§è¡ŒMapReduceï¼Œä¸”è¡¨ç»“æ„å’Œt2å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯æ²¡æœ‰æ•°æ®ã€‚</p>
<p><img src="/2020/01/12/Hiveä»‹ç»/1603614353762.png" alt="1603614353762"></p>
<h3 id="4-Hiveä¸­è¡¨çš„ç±»å‹"><a href="#4-Hiveä¸­è¡¨çš„ç±»å‹" class="headerlink" title="4. Hiveä¸­è¡¨çš„ç±»å‹"></a>4. Hiveä¸­è¡¨çš„ç±»å‹</h3><p>Hiveä¸­æœ‰5ç§è¡¨ï¼šå†…éƒ¨è¡¨ï¼Œå¤–éƒ¨è¡¨ï¼Œä¸´æ—¶è¡¨ï¼Œåˆ†åŒºè¡¨ï¼Œæ¡¶è¡¨ï¼ˆåˆ†æ¡¶è¡¨ï¼‰</p>
<h4 id="4-1-å†…éƒ¨è¡¨ï¼ˆManaged-Tableï¼‰"><a href="#4-1-å†…éƒ¨è¡¨ï¼ˆManaged-Tableï¼‰" class="headerlink" title="4.1 å†…éƒ¨è¡¨ï¼ˆManaged Tableï¼‰"></a><span id="jump4.1">4.1 å†…éƒ¨è¡¨ï¼ˆManaged Tableï¼‰</span></h4><p>å…³äºå†…éƒ¨è¡¨çš„å…¶ä»–å†…å®¹è§ <a href="#jump3.3">3.3 å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨</a><br>æ•°æ®é»˜è®¤å­˜å‚¨åœ¨/user/hive/warehouseï¼Œç”±Hiveè‡ªèº«ç®¡ç†ï¼Œåˆ é™¤å†…éƒ¨è¡¨ä¼šåŒæ—¶åˆ é™¤å­˜å‚¨æ•°æ®å’Œå…ƒæ•°æ®ã€‚</p>
<p><strong>å»ºè¡¨ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// å»ºè¡¨æ–¹å¼ä¸€</span><br><span class="line">create table t1(</span><br><span class="line">    id	INT,</span><br><span class="line">    name STRING,</span><br><span class="line">    age INT,</span><br><span class="line">    gfs ARRAY&lt;STRING&gt;,</span><br><span class="line">    address MAP&lt;STRING,STRING&gt;,</span><br><span class="line">    info STRUCT&lt;country:String,province:String,shi:String&gt;</span><br><span class="line">)</span><br><span class="line">ROW FORMAT DELIMITED </span><br><span class="line">FIELDS TERMINATED BY &apos; &apos; </span><br><span class="line">COLLECTION ITEMS TERMINATED BY &apos;,&apos;</span><br><span class="line">MAP KEYS TERMINATED BY &apos;:&apos; </span><br><span class="line">LINES TERMINATED BY &apos;\n&apos;</span><br><span class="line">LOCATION &quot;/test&quot;;//å¯ä»¥è®¾ç½®æºæ•°æ®çš„ä½ç½®ï¼Œè‹¥ä¸è®¾ç½®é»˜è®¤å°±åœ¨Hiveçš„å·¥ä½œç›®å½•åŒº</span><br><span class="line"></span><br><span class="line">// å»ºè¡¨æ–¹å¼äºŒ</span><br><span class="line">create table gfstbl1 like gfstbl;åªæ˜¯åˆ›å»ºè¡¨ç»“æ„</span><br><span class="line"></span><br><span class="line">// å»ºè¡¨æ–¹å¼ä¸‰</span><br><span class="line">create table gfstbl2 AS SELECT id,name,gfs,address from gfstbl; </span><br><span class="line">  ä¼šåˆ›å»ºç›¸åº”çš„è¡¨ç»“æ„ï¼Œå¹¶ä¸”æ’å…¥æ•°æ®ï¼Œç›¸å½“äºå®Œæ•´çš„èµ‹å€¼</span><br></pre></td></tr></table></figure>
<p>å…³äºå»ºè¡¨çš„æ›´è¯¦ç»†ä»‹ç»è§ <a href="#jump3">3. Hiveå»ºè¡¨è¯­å¥</a></p>
<p><strong>åŠ è½½æ•°æ®ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/root/gfs.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> gfstbl;</span><br></pre></td></tr></table></figure>
<p>æ›´è¯¦ç»†ä»‹ç»è§ 3.5 æ³•ä¸€ï¼šç›´æ¥å»ºè¡¨æ³•ä¸­çš„ <a href="#jump3.5.1.3">3.æ’å…¥æ•°æ®</a></p>
<p><strong>æŸ¥çœ‹è¡¨æè¿°ä¿¡æ¯ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> [<span class="keyword">EXTENDED</span>|FORMATTED] table_name</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE FORMATTED gfstbl;</span><br></pre></td></tr></table></figure>
<p>DESCRIBEæ˜¾ç¤ºåˆ—çš„åˆ—è¡¨ï¼ˆthe list of columnsï¼‰ï¼ŒåŒ…æ‹¬ç»™å®šè¡¨çš„åˆ†åŒºåˆ—ï¼ˆpartition columnsï¼‰ã€‚ å¦‚æœæŒ‡å®šäº†EXTENDEDå…³é”®å­—ï¼Œåˆ™å®ƒå°†ä»¥Thriftåºåˆ—åŒ–å½¢å¼æ˜¾ç¤ºè¡¨çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚ è¿™é€šå¸¸åªåœ¨è°ƒè¯•æ—¶æœ‰ç”¨ï¼Œè€Œä¸é€‚ç”¨äºä¸€èˆ¬ä½¿ç”¨ã€‚ å¦‚æœæŒ‡å®šäº†FORMATTEDå…³é”®å­—ï¼Œåˆ™å®ƒå°†ä»¥è¡¨æ ¼æ ¼å¼æ˜¾ç¤ºå…ƒæ•°æ®ã€‚</p>
<p><strong><span id="jump4.1.insert">æ’å…¥æ•°æ®çš„å…¶ä»–æ–¹å¼ï¼š</span></strong></p>
<p>Syntax:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Standard syntax:</span><br><span class="line">INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...) [IF NOT EXISTS]] select_statement1 FROM from_statement;</span><br><span class="line">INSERT INTO TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1 FROM from_statement;</span><br><span class="line"> </span><br><span class="line">Hive extension (multiple inserts):</span><br><span class="line">FROM from_statement</span><br><span class="line">INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...) [IF NOT EXISTS]] select_statement1</span><br><span class="line">[INSERT OVERWRITE TABLE tablename2 [PARTITION ... [IF NOT EXISTS]] select_statement2]</span><br><span class="line">[INSERT INTO TABLE tablename2 [PARTITION ...] select_statement2] ...;</span><br><span class="line">FROM from_statement</span><br><span class="line">INSERT INTO TABLE tablename1 [PARTITION (partcol1=val1, partcol2=val2 ...)] select_statement1</span><br><span class="line">[INSERT INTO TABLE tablename2 [PARTITION ...] select_statement2]</span><br><span class="line">[INSERT OVERWRITE TABLE tablename2 [PARTITION ... [IF NOT EXISTS]] select_statement2] ...;</span><br><span class="line"> </span><br><span class="line">Hive extension (dynamic partition inserts):</span><br><span class="line">INSERT OVERWRITE TABLE tablename PARTITION (partcol1[=val1], partcol2[=val2] ...) select_statement FROM from_statement;</span><br><span class="line">INSERT INTO TABLE tablename PARTITION (partcol1[=val1], partcol2[=val2] ...) select_statement FROM from_statement;</span><br></pre></td></tr></table></figure>
<p>è§£é‡Šï¼š</p>
<ul>
<li>INSERT OVERWRITEå°†è¦†ç›–è¡¨æˆ–åˆ†åŒºä¸­çš„ä»»ä½•ç°æœ‰æ•°æ®<ul>
<li>unless <code>IF NOT EXISTS</code> is provided for a partition (as of Hive <a href="https://issues.apache.org/jira/browse/HIVE-2612" target="_blank" rel="noopener">0.9.0</a>).</li>
<li>As of Hive 2.3.0 (<a href="https://issues.apache.org/jira/browse/HIVE-15880" target="_blank" rel="noopener">HIVE-15880</a>), if the table has <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-listTableProperties" target="_blank" rel="noopener">TBLPROPERTIES</a> (â€œauto.purgeâ€=â€trueâ€) the previous data of the table is not moved to Trash when INSERT OVERWRITE query is run against the table. This functionality is applicable only for managed tables (see <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-ManagedandExternalTables" target="_blank" rel="noopener">managed tables</a>) and is turned off when â€œauto.purgeâ€ property is unset or set to false.</li>
</ul>
</li>
<li>INSERT INTOå°†è¿½åŠ åˆ°è¡¨æˆ–åˆ†åŒºï¼Œä¿æŒç°æœ‰æ•°æ®ä¸å˜ã€‚<ul>
<li>As of Hive <a href="https://issues.apache.org/jira/browse/HIVE-6406" target="_blank" rel="noopener">0.13.0</a>, a table can be made <strong>immutable</strong> by creating it with <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-CreateTable" target="_blank" rel="noopener">TBLPROPERTIES (â€œimmutableâ€=â€trueâ€)</a>. The default is â€œimmutableâ€=â€falseâ€.<br>INSERT INTO behavior into an immutable table is disallowed if any data is already present, although INSERT INTO still works if the immutable table is empty.<br>å¦‚æœè¡¨ä¸­å·²ç»å­˜åœ¨ä»»ä½•æ•°æ®ï¼Œåˆ™ä¸å…è®¸åœ¨ä¸å¯å˜è¡¨ä¸­æ‰§è¡ŒINSERT INTOè¡Œä¸ºï¼Œä½†å¦‚æœä¸å¯å˜è¡¨ä¸ºç©ºï¼Œåˆ™æ’å…¥INTOä»ç„¶å¯ä»¥å·¥ä½œã€‚ INSERT OVERWRITE çš„è¡Œä¸ºä¸å—â€œä¸å¯å˜â€è¡¨å±æ€§çš„å½±å“ã€‚The behavior of INSERT OVERWRITE is not affected by the â€œimmutableâ€ table property.<br>ä¸å¯å˜è¡¨å¯ä»¥é˜²æ­¢ç”±äºè„šæœ¬é”™è¯¯åœ°å¤šæ¬¡è¿è¡Œè€Œå°†æ•°æ®åŠ è½½åˆ°è¡¨ä¸­çš„æ„å¤–æ›´æ–°ã€‚The first insert into an immutable table succeeds and successive inserts fail, resulting in only one set of data in the table, instead of silently succeeding with multiple copies of the data in the table.</li>
</ul>
</li>
<li>å¯ä»¥å¯¹è¡¨æˆ–åˆ†åŒºè¿›è¡Œæ’å…¥ã€‚If the table is partitioned, then one must specify a specific partition of the table by specifying values for all of the partitioning columns. If <a href="https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.typecheck.on.insert" target="_blank" rel="noopener">hive.typecheck.on.insert</a> is set to true, these values are validated, converted and normalized to conform to their column types (Hive <a href="https://issues.apache.org/jira/browse/HIVE-5297" target="_blank" rel="noopener">0.12.0</a> onward). </li>
<li>å¯ä»¥åœ¨åŒä¸€æŸ¥è¯¢ä¸­æŒ‡å®šå¤šä¸ªæ’å…¥å­å¥ï¼ˆä¹Ÿç§°ä¸ºå¤šè¡¨æ’å…¥ï¼‰ã€‚</li>
<li>The output of each of the select statements is written to the chosen table (or partition). Currently the OVERWRITE keyword is mandatory and implies that the contents of the chosen table or partition are replaced with the output of corresponding select statement.</li>
<li>The output format and serialization class is determined by the tableâ€™s metadata (as specified via DDL commands on the table).</li>
<li>As of Hive <a href="https://issues.apache.org/jira/browse/HIVE-9353" target="_blank" rel="noopener">1.1.0</a> the TABLE keyword is optional.</li>
<li>As of Hive <a href="https://issues.apache.org/jira/browse/HIVE-9481" target="_blank" rel="noopener">1.2.0</a> each INSERT INTO T can take a column list like INSERT INTO T (z, x, c1).  See Description of <a href="https://issues.apache.org/jira/browse/HIVE-9481" target="_blank" rel="noopener">HIVE-9481</a> for examples.</li>
</ul>
<p><strong>Notes</strong></p>
<ul>
<li>Multi Table Inserts minimize the number of data scans required. Hive can insert data into multiple tables by scanning the input data just once (and applying different query operators) to the input data. å¤šè¡¨æ’å…¥å¯æœ€å¤§ç¨‹åº¦åœ°å‡å°‘æ‰€éœ€çš„æ•°æ®æ‰«ææ¬¡æ•°ã€‚ Hiveå¯ä»¥é€šè¿‡åªæ‰«æä¸€æ¬¡è¾“å…¥æ•°æ®ï¼ˆå¹¶åº”ç”¨ä¸åŒçš„æŸ¥è¯¢è¿ç®—ç¬¦ï¼‰åˆ°è¾“å…¥æ•°æ®æ¥å°†æ•°æ®æ’å…¥åˆ°å¤šä¸ªè¡¨ä¸­ã€‚</li>
<li>Starting with <a href="https://issues.apache.org/jira/browse/HIVE-1180" target="_blank" rel="noopener">Hive 0.13.0</a>, the select statement can include one or more common table expressions (CTEs) as shown in the <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select#LanguageManualSelect-SelectSyntax" target="_blank" rel="noopener">SELECT syntax</a>. For an example, see <a href="https://cwiki.apache.org/confluence/display/Hive/Common+Table+Expression#CommonTableExpression-CTEinViews,CTAS,andInsertStatements" target="_blank" rel="noopener">Common Table Expression</a>.</li>
</ul>
<p>ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">insert into rest select count(*) from table;</span><br><span class="line">		</span><br><span class="line">ä¹ æƒ¯å†™æ³• fromæå‰  å‡å°‘SQLä»£ç çš„å†—ä½™</span><br><span class="line">from day_hour_table</span><br><span class="line">insert into rest </span><br><span class="line">select count(*) ;</span><br></pre></td></tr></table></figure>
<h4 id="4-2-å¤–éƒ¨è¡¨ï¼ˆExternal-Tableï¼‰"><a href="#4-2-å¤–éƒ¨è¡¨ï¼ˆExternal-Tableï¼‰" class="headerlink" title="4.2 å¤–éƒ¨è¡¨ï¼ˆExternal Tableï¼‰"></a><span id="jump4.2">4.2 å¤–éƒ¨è¡¨ï¼ˆExternal Tableï¼‰</span></h4><p>æ›´å¤šå…³äºå¤–éƒ¨è¡¨çš„å†…å®¹è§ <a href="#jump3.3">3.3 å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨</a></p>
<p>æ•°æ®å­˜å‚¨ä½ç½®ç”±ç”¨æˆ·è‡ªå·±æŒ‡å®šï¼Œ<strong>ç”±HDFSç®¡ç†ï¼Œåˆ é™¤å¤–éƒ¨è¡¨æ—¶ä»…ä»…ä¼šåˆ é™¤å…ƒæ•°æ®ï¼Œå­˜å‚¨æ•°æ®ä¸ä¼šå—åˆ°å½±å“ã€‚</strong></p>
<ul>
<li><p>é€‚ç”¨æƒ…å½¢ï¼š<br>å½“ä¸€ä»½æ—¥å¿—éœ€è¦å¤šä¸ªå°ç»„ä¸€èµ·åˆ†æï¼Œåˆ†æå®Œäº†ä¹‹ååˆ›å»ºçš„è¡¨å°±å¯ä»¥åˆ é™¤äº†ã€‚ä½†æ˜¯æ™®é€šçš„è¡¨åˆ é™¤çš„åŒæ—¶ä¹Ÿä¼šæŠŠæ•°æ®åˆ é™¤ï¼Œè¿™æ ·å°±ä¼šå½±å“åˆ°å…¶ä»–å°ç»„çš„åˆ†æï¼Œè€Œä¸”æ—¥å¿—æ•°æ®ä¹Ÿä¸èƒ½éšä¾¿åˆ é™¤ã€‚æ‰€ä»¥ï¼Œéœ€è¦å¤–éƒ¨è¡¨ï¼Œåˆ é™¤å¤–éƒ¨è¡¨ï¼Œä¸ä¼šåˆ é™¤å¯¹åº”çš„HDFSä¸Šçš„æ•°æ®ã€‚</p>
</li>
<li><p>å¯¹æ¯”å¤–éƒ¨è¡¨å’Œå†…éƒ¨è¡¨åŒºåˆ«<br>åˆ é™¤å¤–éƒ¨è¡¨ï¼Œæ•°æ®ä¸ä¼šæœ‰ä»»ä½•æ”¹å˜ï¼Œåªæ˜¯mysqlä¸­çš„å…ƒæ•°æ®è¢«ä¿®æ”¹ï¼Œä½†æ˜¯åˆ é™¤å†…éƒ¨è¡¨ï¼ˆç®¡ç†è¡¨ï¼‰ï¼Œæ•°æ®å°±ä¼šè¢«åˆ é™¤ã€‚</p>
</li>
</ul>
<p><strong>å»ºè¡¨ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> wc_external (</span><br><span class="line">    word1 <span class="keyword">STRING</span>, </span><br><span class="line">    word2 <span class="keyword">STRING</span></span><br><span class="line">) </span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> </span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">' '</span> </span><br><span class="line">location <span class="string">'/test/external'</span>; locationå¯åŠ å¯ä¸åŠ ï¼Œä¸åŠ locationé»˜è®¤æ˜¯åœ¨hiveçš„å·¥ä½œç›®å½•åŒº</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ€»ç»“ï¼šhiveå†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨çš„åŒºåˆ«<br>    1ï¼‰åˆ›å»ºè¡¨æ—¶ï¼šåˆ›å»ºå†…éƒ¨è¡¨æ—¶ï¼Œä¼šå°†æ•°æ®ç§»åŠ¨åˆ°æ•°æ®ä»“åº“æŒ‡å‘çš„è·¯å¾„ï¼›è‹¥åˆ›å»ºå¤–éƒ¨è¡¨ï¼Œä»…è®°å½•æ•°æ®æ‰€åœ¨çš„è·¯å¾„ï¼Œ ä¸å¯¹æ•°æ®çš„ä½ç½®åšä»»ä½•æ”¹å˜ã€‚<br>    2ï¼‰åˆ é™¤è¡¨æ—¶ï¼šåœ¨åˆ é™¤è¡¨çš„æ—¶å€™ï¼Œå†…éƒ¨è¡¨çš„å…ƒæ•°æ®å’Œæ•°æ®ä¼šè¢«ä¸€èµ·åˆ é™¤ï¼Œè€Œå¤–éƒ¨è¡¨åªåˆ é™¤å…ƒæ•°æ®ï¼Œä¸åˆ é™¤æ•°æ®ã€‚è¿™æ ·å¤–éƒ¨è¡¨ç›¸å¯¹æ¥è¯´æ›´åŠ å®‰å…¨äº›ï¼Œæ•°æ®ç»„ç»‡ä¹Ÿæ›´åŠ çµæ´»ï¼Œæ–¹ä¾¿å…±äº«æºæ•°æ®</p>
</blockquote>
<h4 id="4-3-ä¸´æ—¶è¡¨ï¼ˆTemporary-Tableï¼‰"><a href="#4-3-ä¸´æ—¶è¡¨ï¼ˆTemporary-Tableï¼‰" class="headerlink" title="4.3 ä¸´æ—¶è¡¨ï¼ˆTemporary Tableï¼‰"></a>4.3 ä¸´æ—¶è¡¨ï¼ˆTemporary Tableï¼‰</h4><p>åœ¨å½“å‰ä¼šè¯æœŸé—´å­˜åœ¨ï¼Œä¼šè¯ç»“æŸåè‡ªåŠ¨é”€æ¯ã€‚</p>
<ul>
<li>é€‚ç”¨æƒ…å½¢<br>ä¸´æ—¶åˆ†æï¼Œåœ¨å…³é—­hiveå®¢æˆ·ç«¯åï¼Œä¸´æ—¶è¡¨å°±ä¼šæ¶ˆå¤±ã€‚ä¸»è¦ç”¨äºå­˜å‚¨ä¸é‡è¦ä¸­é—´ç»“æœé›†ï¼Œä¸é‡è¦çš„è¡¨ã€‚</li>
</ul>
<p>ä¸´æ—¶è¡¨å…·æœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p>
<ul>
<li>ä¸æ”¯æŒåˆ†åŒºåˆ—ã€‚</li>
<li>ä¸æ”¯æŒåˆ›å»ºç´¢å¼•ã€‚</li>
</ul>
<p><strong>å»ºè¡¨ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TEMPORARY</span> <span class="keyword">table</span> ttabc(<span class="keyword">id</span> <span class="built_in">Int</span>,<span class="keyword">name</span> <span class="keyword">String</span>) ä¸´æ—¶è¡¨çš„å£°æ˜å‘¨æœŸæ˜¯ä¸€æ¬¡ä¼šè¯</span><br><span class="line">è¿›å…¥hive shell åˆ›å»ºä¸€å¼ è¡¨ï¼Œå…³é—­shellåï¼Œè¡¨ä¸¢å¤±ï¼Œä¸´æ—¶è¡¨ä¸æ”¯æŒåˆ†åŒº</span><br></pre></td></tr></table></figure>
<p><strong>å»ºè¡¨å¹¶åŠ è½½æ•°æ®ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TEMPORARY</span> <span class="keyword">table</span> dept_tmp(  </span><br><span class="line">    deptno <span class="built_in">int</span>,  </span><br><span class="line">    dname <span class="keyword">string</span>,</span><br><span class="line">    loc <span class="keyword">string</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span>  </span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/opt/datas/dept.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> dept_tmp;</span><br></pre></td></tr></table></figure>
<p><strong>æŸ¥çœ‹locationä¿¡æ¯ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">desc formatted dept_tmp;</span><br><span class="line">Location:               hdfs://172.19.199.187:8020/tmp/hive/hadoop/68174383-f427-4629-9707-0ab1c9b07726/_tmp_space.db/d872efec-1294-48b0-9071-31cf98d46400    </span><br><span class="line">Table Type:             MANAGED_TABLE</span><br></pre></td></tr></table></figure>
<h4 id="4-4-åˆ†åŒºè¡¨ï¼ˆPartitioned-Tableï¼‰"><a href="#4-4-åˆ†åŒºè¡¨ï¼ˆPartitioned-Tableï¼‰" class="headerlink" title="4.4 åˆ†åŒºè¡¨ï¼ˆPartitioned Tableï¼‰"></a><span id="jump4.4">4.4 åˆ†åŒºè¡¨ï¼ˆPartitioned Tableï¼‰</span></h4><p>å¦å¤–å…³äºåˆ†åŒºè¡¨çš„å†…å®¹è§ <a href="#jump3.4">3.4 Partitioned Tables</a></p>
<p>å°†æ•°æ®æŒ‰ç…§æŸä¸ªå­—æ®µæˆ–è€…å…³é”®å­—åˆ†æˆå¤šä¸ªå­ç›®å½•æ¥å­˜å‚¨ï¼Œé˜²æ­¢æš´åŠ›æ‰«æå…¨è¡¨ã€‚</p>
<ul>
<li><p>é€‚ç”¨æƒ…å½¢</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from logs where date = &apos;20171209&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ™®é€šè¡¨æ‰§è¡Œæµç¨‹ï¼šå¯¹å…¨è¡¨çš„æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åè¿›è¡Œè¿‡æ»¤æ“ä½œã€‚</li>
<li>åˆ†åŒºè¡¨æ‰§è¡Œæµç¨‹ï¼šç›´æ¥åŠ è½½å¯¹åº”æ–‡ä»¶è·¯å¾„ä¸‹çš„æ•°æ®ã€‚</li>
</ul>
<p>é€‚ç”¨äºå¤§æ•°æ®é‡ï¼Œå¯ä»¥é€šè¿‡åˆ†åŒºå¿«é€Ÿå®šä½éœ€è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œ<strong>åˆ†åŒºè¡¨çš„ä½œç”¨ä¸»è¦æ˜¯æé«˜æŸ¥è¯¢æ£€ç´¢çš„æ•ˆç‡ ã€‚</strong></p>
</li>
</ul>
<p><strong>é™æ€åˆ†åŒºè¡¨ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> day_hour_table (<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">content</span> <span class="keyword">string</span>) partitioned <span class="keyword">by</span> (dt <span class="built_in">int</span>,<span class="keyword">hour</span> <span class="built_in">int</span>) </span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> </span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\t'</span> ;</span><br></pre></td></tr></table></figure>
<p><strong>åŠ è½½æ•°æ®ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- insertå•æ¡æ’å…¥çš„æ–¹å¼å¾€åˆ†åŒºè¡¨ä¸­æ’å…¥æ•°æ®ï¼š</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> day_hour_table <span class="keyword">partition</span>(dt=<span class="number">9</span>,<span class="keyword">hour</span>=<span class="number">1</span>) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">"a2 bc"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> day_hour_table <span class="keyword">partition</span>(dt=<span class="number">9</span>,<span class="keyword">hour</span>=<span class="number">2</span>) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">"a2 bc"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> day_hour_table <span class="keyword">partition</span>(dt=<span class="number">8</span>,<span class="keyword">hour</span>=<span class="number">1</span>) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">"a2 bc"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> day_hour_table <span class="keyword">partition</span>(dt=<span class="number">8</span>,<span class="keyword">hour</span>=<span class="number">2</span>) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">"a2 bc"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- loadæ‰¹é‡æ’å…¥çš„æ–¹å¼å¾€åˆ†åŒºè¡¨ä¸­æ’å…¥æ•°æ®ï¼š</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">"/root/ceshi"</span> <span class="keyword">into</span> <span class="keyword">table</span> day_table <span class="keyword">partition</span> (dt=<span class="number">10</span>,<span class="keyword">hour</span>=<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p><strong>åˆ é™¤Hiveåˆ†åŒºè¡¨ä¸­çš„åˆ†åŒºï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> day_table <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> (dt=<span class="number">10</span>,<span class="keyword">hour</span>=<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p><strong>åˆ›å»º\æ·»åŠ åˆ†åŒºï¼š</strong></p>
<p>Syntax:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] <span class="keyword">PARTITION</span> partition_spec [LOCATION <span class="string">'location'</span>]</span><br><span class="line">[, <span class="keyword">PARTITION</span> partition_spec [LOCATION <span class="string">'location'</span>], ...];</span><br><span class="line"></span><br><span class="line">partition_spec:</span><br><span class="line">	  : (partition_column = partition_col_value, partition_column = partition_col_value, ...)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºä¸€ä¸ªç©ºåˆ†åŒºï¼š</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> day_hour_table <span class="keyword">ADD</span> <span class="keyword">PARTITION</span> (dt=<span class="number">10000</span>, <span class="keyword">hour</span>=<span class="number">2000</span>);</span><br><span class="line"><span class="comment">-- ç„¶åå°†æ•°æ®ä¸Šä¼ åˆ°ç©ºåˆ†åŒºå¯¹åº”çš„ç›®å½•ä¸‹ï¼Œåˆ†åŒºè¡¨ä¸­å°±ä¼šæ˜¾ç¤ºæ•°æ®</span></span><br><span class="line">HDFS dfs -put ........</span><br><span class="line"><span class="comment">-- åˆ›å»ºä¸€ä¸ªç©ºåˆ†åŒºå¹¶ä¸”å°†ç©ºåˆ†åŒºæŒ‡å‘æ•°æ®ä½ç½®ï¼š</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> day_hour_table <span class="keyword">ADD</span> <span class="keyword">PARTITION</span> (dt=<span class="number">10000</span>, <span class="keyword">hour</span>=<span class="number">2000</span>) location <span class="string">"/test"</span></span><br></pre></td></tr></table></figure>
<p><strong>åŠ¨æ€åˆ†åŒºè¡¨ï¼š</strong></p>
<p>åŠ¨æ€åˆ†åŒºè¡¨å’Œé™æ€åˆ†åŒºè¡¨å»ºè¡¨è¯­å¥ç›¸åŒï¼Œæ’å…¥æ•°æ®çš„æ–¹å¼ä¸åŒ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition=<span class="literal">true</span>;</span><br><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition.mode=nonstrict;</span><br></pre></td></tr></table></figure>
<p>åŠ¨æ€åˆ†åŒºå¯ä»¥æ ¹æ®æ•°æ®æœ¬èº«çš„ç‰¹å¾è‡ªåŠ¨æ¥åˆ’åˆ†åˆ†åŒºï¼Œ<code>load data â€¦</code> åªæ˜¯å°†æ•°æ®ä¸Šä¼ åˆ°HDFSæŒ‡å®šç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨from insertçš„æ–¹å¼æ’å…¥æ•°æ®ï¼Œhiveæ‰ä¼šæ ¹æ®åˆ†åŒºè®¾ç½®è‡ªåŠ¨å°†æ•°æ®è¿›è¡Œåˆ†åŒºã€‚ï¼ˆè¯¦ç»†å†…å®¹è§ğŸ‘‡ï¼‰</p>
<p><strong>åŠ¨æ€åˆ†åŒºæ’å…¥ï¼ˆDynamic Partition Insertsï¼‰</strong></p>
<blockquote>
<p>å‚è€ƒ <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML</a></p>
</blockquote>
<p>åœ¨åŠ¨æ€åˆ†åŒºæ’å…¥ä¸­ï¼Œç”¨æˆ·å¯ä»¥æä¾›éƒ¨åˆ†åˆ†åŒºè§„èŒƒï¼Œè¿™æ„å‘³ç€åªéœ€åœ¨PARTITIONå­å¥ä¸­æŒ‡å®šåˆ†åŒºåˆ—ååˆ—è¡¨ ( specifying the list of partition column names)ã€‚åˆ—å€¼æ˜¯å¯é€‰çš„ (The column values are optional)ã€‚å¦‚æœç»™å®šä¸€ä¸ªåˆ†åŒºåˆ—å€¼ (partition column value)ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºé™æ€åˆ†åŒºï¼Œå¦åˆ™ä¸ºåŠ¨æ€åˆ†åŒºã€‚æ¯ä¸ªåŠ¨æ€åˆ†åŒºåˆ—éƒ½æœ‰ä¸€ä¸ªæ¥è‡ªselectè¯­å¥çš„ç›¸åº”è¾“å…¥åˆ—ã€‚è¿™æ„å‘³ç€åŠ¨æ€åˆ†åŒºçš„åˆ›å»ºç”±è¾“å…¥åˆ—çš„å€¼å†³å®šã€‚åŠ¨æ€åˆ†åŒºåˆ—å¿…é¡»åœ¨SELECTè¯­å¥çš„åˆ—ä¸­æœ€åæŒ‡å®šï¼Œå¹¶ä¸”æŒ‰ç…§å®ƒä»¬åœ¨PARTITION()å­å¥ä¸­å‡ºç°çš„é¡ºåºæŒ‡å®šã€‚</p>
<blockquote>
<p>In the dynamic partition inserts, users can give partial partition specifications, which means just specifying the list of partition column names in the PARTITION clause. The column values are optional. If a partition column value is given, we call this a static partition, otherwise it is a dynamic partition. Each dynamic partition column has a corresponding input column from the select statement. This means that the dynamic partition creation is determined by the value of the input column. The dynamic partition columns must be <strong>specified last</strong> among the columns in the SELECT statement and <strong>in the same order</strong> in which they appear in the PARTITION() clause.</p>
</blockquote>
<p>As of Hive 3.0.0 (<a href="https://issues.apache.org/jira/browse/HIVE-19083" target="_blank" rel="noopener">HIVE-19083</a>) there is no need to specify dynamic partition columns. Hive will automatically generate partition specification if it is not specified.</p>
<style>
table th:first-of-type {
    width: 220px;
}
table th:nth-of-type(2) {
    width: 70px;
}
</style>

<div class="table-container">
<table>
<thead>
<tr>
<th>Configuration property</th>
<th>Default</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hive.exec.dynamic.partition</code></td>
<td><code>true</code></td>
<td>Needs to be set to <code>true</code> to enable dynamic partition inserts</td>
</tr>
<tr>
<td><code>hive.exec.dynamic.partition.mode</code></td>
<td><code>strict</code></td>
<td>In <code>strict</code> mode, the user must specify at least one static partition in case the user accidentally overwrites all partitions, in <code>nonstrict</code> mode all partitions are allowed to be dynamic</td>
</tr>
<tr>
<td><code>hive.exec.max.dynamic.partitions.pernode</code></td>
<td>100</td>
<td>Maximum number of dynamic partitions allowed to be created in each mapper/reducer node</td>
</tr>
<tr>
<td><code>hive.exec.max.dynamic.partitions</code></td>
<td>1000</td>
<td>Maximum number of dynamic partitions allowed to be created in total</td>
</tr>
<tr>
<td><code>hive.exec.max.created.files</code></td>
<td>100000</td>
<td>Maximum number of HDFS files created by all mappers/reducers in a MapReduce job</td>
</tr>
<tr>
<td><code>hive.error.on.empty.partition</code></td>
<td><code>false</code></td>
<td>Whether to throw an exception if dynamic partition insert generates empty results</td>
</tr>
</tbody>
</table>
</div>
<p>ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM page_view_stg pvs</span><br><span class="line">INSERT OVERWRITE TABLE page_view PARTITION(dt=&apos;2008-06-08&apos;, country)</span><br><span class="line">       SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, null, null, pvs.ip, pvs.cnt</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œcountry åˆ†åŒºå°†ç”±SELECTå­å¥çš„æœ€åä¸€åˆ—ï¼ˆå³pvs.cntï¼‰åŠ¨æ€åˆ›å»ºã€‚Note that the name is not used. åœ¨ nonstrict æ¨¡å¼ä¸‹ï¼Œthe <code>dt</code> partition could also be dynamically created.</p>
<p>å…³äº INSERT çš„è¯­æ³•è§ 4.1 å†…éƒ¨è¡¨ï¼ˆManaged Tableï¼‰ä¸­çš„<a href="#jump4.1.insert">æ’å…¥æ•°æ®çš„å…¶ä»–æ–¹å¼</a>éƒ¨åˆ†.</p>
<h4 id="4-5-åˆ†æ¡¶è¡¨ï¼ˆBucked-Tablesï¼‰"><a href="#4-5-åˆ†æ¡¶è¡¨ï¼ˆBucked-Tablesï¼‰" class="headerlink" title="4.5 åˆ†æ¡¶è¡¨ï¼ˆBucked Tablesï¼‰"></a><span id="jump4.5">4.5 åˆ†æ¡¶è¡¨ï¼ˆBucked Tablesï¼‰</span></h4><p>å°†æ•°æ®æŒ‰ç…§æŸä¸ªå­—æ®µå’Œæ¡¶çš„æ•°é‡ï¼Œå¯¹æŒ‡å®šå­—æ®µè¿›è¡Œå–æ¨¡è¿ç®—ï¼Œæ‹†åˆ†æˆå¤šä¸ªå°æ–‡ä»¶æ¥å­˜å‚¨ï¼Œæ¨¡ç›¸åŒçš„å­˜å‚¨åœ¨åŒä¸€ä¸ªå°æ–‡ä»¶ä¸­ï¼Œæé«˜joinä»¥åŠæŠ½æ ·çš„æ•ˆç‡ã€‚</p>
<ul>
<li>é€‚ç”¨æƒ…å½¢<br>æ•°æ®æœ‰ä¸¥é‡çš„æ•°æ®å€¾æ–œï¼Œåˆ†å¸ƒä¸å‡åŒ€ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´æ¯ä¸ªæ¡¶ä¸­çš„æ•°æ®é‡ä¼šæ¯”è¾ƒå¹³å‡ã€‚æ¡¶ä¸æ¡¶ä¹‹é—´åšjoinç­‰æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šæœ‰ä¼˜åŒ–ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.enforce.bucketing=<span class="literal">true</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp_bu(  </span><br><span class="line">    empno <span class="built_in">int</span>,  </span><br><span class="line">    ename <span class="keyword">string</span>,</span><br><span class="line">    job <span class="keyword">string</span>,  </span><br><span class="line">    mgr <span class="built_in">int</span>,</span><br><span class="line">    hiredate <span class="keyword">string</span>,  </span><br><span class="line">    sal <span class="keyword">double</span>,  </span><br><span class="line">    comm <span class="keyword">double</span>,  </span><br><span class="line">    deptno <span class="built_in">int</span></span><br><span class="line">)</span><br><span class="line">CLUSTERED <span class="keyword">BY</span>(deptno) <span class="keyword">INTO</span> <span class="number">4</span> BUCKETS</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span>  </span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> emp_bu_2 <span class="keyword">select</span> * <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<p>åˆ†æ¡¶è¡¨æ˜¯å¯¹åˆ—å€¼å–å“ˆå¸Œå€¼çš„æ–¹å¼ï¼Œå°†ä¸åŒæ•°æ®æ”¾åˆ°ä¸åŒæ–‡ä»¶ä¸­å­˜å‚¨ï¼Œç”±åˆ—å€¼çš„å“ˆå¸Œå€¼é™¤ä»¥æ¡¶çš„ä¸ªæ•°æ¥å†³å®šæ¯æ¡æ•°æ®åˆ’åˆ†åœ¨å“ªä¸ªæ¡¶ä¸­ã€‚å¯¹äºhiveä¸­æ¯ä¸€ä¸ªè¡¨ã€åˆ†åŒºéƒ½å¯ä»¥è¿›ä¸€æ­¥è¿›è¡Œåˆ†æ¡¶ã€‚</p>
<p>For an int, itâ€™s easy, <code>hash_int(i) == i</code>. ä¾‹å¦‚åŸºäºuser_idè¿›è¡Œåˆ†æ¡¶æ—¶ï¼Œ if user_id were an int, and there were 10 buckets, we would expect all user_idâ€™s that end in 0 to be in bucket 1, all user_idâ€™s that end in a 1 to be in bucket 2, etc. </p>
<p><strong>å»ºè¡¨ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> psnbucket( </span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>, </span><br><span class="line">    <span class="keyword">name</span> <span class="keyword">STRING</span>, </span><br><span class="line">    age <span class="built_in">INT</span></span><br><span class="line">) </span><br><span class="line">CLUSTERED <span class="keyword">BY</span> (age) <span class="keyword">INTO</span> <span class="number">4</span> BUCKETS </span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> </span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure>
<p><strong>æ’å…¥æ•°æ®ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> psnbucket <span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span>, age <span class="keyword">from</span> original;</span><br></pre></td></tr></table></figure>
<p><strong>åˆ†æ¡¶è¡¨+åˆ†åŒºè¡¨ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> psnbucket_partition( </span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span>, </span><br><span class="line">    <span class="keyword">name</span> <span class="keyword">STRING</span>, </span><br><span class="line">    age <span class="built_in">INT</span></span><br><span class="line">) </span><br><span class="line">PARTITIONED <span class="keyword">BY</span>(height <span class="keyword">DOUBLE</span>) </span><br><span class="line">CLUSTERED <span class="keyword">BY</span> (age) <span class="keyword">INTO</span> <span class="number">4</span> BUCKETS </span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> </span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>å‚è€ƒ <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL+BucketedTables" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL+BucketedTables</a></p>
</blockquote>
<p>Bucketed tables are fantastic in that they allow much more efficient <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Sampling" target="_blank" rel="noopener">sampling</a> than do non-bucketed tables, and they may later allow for time saving operations such as mapside joins. However, the bucketing specified at table creation is not enforced when the table is written to, and so it is possible for the tableâ€™s metadata to advertise properties which are not upheld by the tableâ€™s actual layout. This should obviously be avoided. Hereâ€™s how to do it right.</p>
<p>First, <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-Create/Drop/TruncateTable" target="_blank" rel="noopener">table creation</a>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_info_bucketed(user_id <span class="built_in">BIGINT</span>, firstname <span class="keyword">STRING</span>, lastname <span class="keyword">STRING</span>)</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="string">'A bucketed copy of user_info'</span></span><br><span class="line">PARTITIONED <span class="keyword">BY</span>(ds <span class="keyword">STRING</span>)</span><br><span class="line">CLUSTERED <span class="keyword">BY</span>(user_id) <span class="keyword">INTO</span> <span class="number">256</span> BUCKETS;</span><br></pre></td></tr></table></figure>
<p>Note that we specify a column (user_id) to base the bucketing.<br>Then we populate the table</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.enforce.bucketing = <span class="literal">true</span>;  <span class="comment">-- (<span class="doctag">Note:</span> Not needed in Hive 2.x onward)</span></span><br><span class="line">FROM user_id</span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> user_info_bucketed</span><br><span class="line"><span class="keyword">PARTITION</span> (ds=<span class="string">'2009-02-25'</span>)</span><br><span class="line"><span class="keyword">SELECT</span> userid, firstname, lastname <span class="keyword">WHERE</span> ds=<span class="string">'2009-02-25'</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Version 0.x and 1.x only</strong><br>The command <code>set hive.enforce.bucketing = true;</code> allows the correct number of reducers and the cluster by column to be automatically selected based on the table. Otherwise, you would need to set the number of reducers to be the same as the number of buckets as in <code>set mapred.reduce.tasks = 256;</code> and have a <code>CLUSTER BY ...</code> clause in the select.</p>
</blockquote>
<p>What can go wrong? As long as you use the syntax above and <code>set hive.enforce.bucketing = true</code> (for Hive 0.x and 1.x), the tables should be populated properly. Things can go wrong if the bucketing column type is different during the insert and on read, or if you manually cluster by a value thatâ€™s different from the table definition.</p>
<p><strong>Bucketed Sorted Tables</strong></p>
<blockquote>
<p>å‚è€ƒ<br><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-TemporaryTables" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-TemporaryTables</a></p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_view(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">     page_url <span class="keyword">STRING</span>, referrer_url <span class="keyword">STRING</span>,</span><br><span class="line">     ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>)</span><br><span class="line"> <span class="keyword">COMMENT</span> <span class="string">'This is the page view table'</span></span><br><span class="line"> PARTITIONED <span class="keyword">BY</span>(dt <span class="keyword">STRING</span>, country <span class="keyword">STRING</span>)</span><br><span class="line"> CLUSTERED <span class="keyword">BY</span>(userid) SORTED <span class="keyword">BY</span>(viewTime) <span class="keyword">INTO</span> <span class="number">32</span> BUCKETS</span><br><span class="line"> <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line">   <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\001'</span></span><br><span class="line">   COLLECTION ITEMS <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\002'</span></span><br><span class="line">   <span class="keyword">MAP</span> <span class="keyword">KEYS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\003'</span></span><br><span class="line"> <span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;</span><br></pre></td></tr></table></figure>
<p>In the example above, the page_view table is bucketed (clustered by) userid and within each bucket the data is sorted in increasing order of viewTime. Such an organization allows the user to do efficient sampling on the clustered column - in this case userid. The sorting property allows internal operators to take advantage of the better-known data structure while evaluating queries, also increasing efficiency. MAP KEYS and COLLECTION ITEMS keywords can be used if any of the columns are lists or maps.</p>
<p>CLUSTERED BYå’ŒSORTED BYåˆ›å»ºå‘½ä»¤ä¸ä¼šå½±å“å°†æ•°æ®æ’å…¥è¡¨çš„æ–¹å¼ï¼Œè€Œåªä¼šå½±å“æ•°æ®çš„è¯»å–æ–¹å¼ã€‚ è¿™æ„å‘³ç€ç”¨æˆ·å¿…é¡»æ³¨æ„æ­£ç¡®åœ°æ’å…¥æ•°æ®ï¼Œæ–¹æ³•æ˜¯å°†reducerçš„æ•°é‡æŒ‡å®šä¸ºç­‰äºå­˜å‚¨æ¡¶çš„æ•°é‡ï¼Œå¹¶åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨CLUSTER BYå’ŒSORT BYå‘½ä»¤ã€‚</p>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Hadoop/" rel="tag"># Hadoop</a>
          
            <a href="/tags/Hive/" rel="tag"># Hive</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/01/12/ç¬”è¯•çŸ¥è¯†ç‚¹/" rel="next" title="ç¬”è¯•çŸ¥è¯†ç‚¹">
                <i class="fa fa-chevron-left"></i> ç¬”è¯•çŸ¥è¯†ç‚¹
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/01/13/è§†å›¾View/" rel="prev" title="è§†å›¾View">
                è§†å›¾View <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="qypx">
            
              <p class="site-author-name" itemprop="name">qypx</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">103</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">46</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/qypx" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          


          
          

          
          

          


          <!-- æ–°å¢çš„å†…å®¹ -->
          <!-- require APlayer -->
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
          <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
          <!-- require MetingJS -->
          <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

          <meting-js server="netease" type="playlist" id="4870130923" list-folded="true" order="random">
          </meting-js>
          <!-- æ–°å¢çš„å†…å®¹end -->

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-ä»€ä¹ˆæ˜¯Hiveï¼Ÿ"><span class="nav-text">1.ä»€ä¹ˆæ˜¯Hiveï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Hiveçš„åŸç†"><span class="nav-text">2.Hiveçš„åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Hiveå»ºè¡¨è¯­å¥"><span class="nav-text">3.Hiveå»ºè¡¨è¯­å¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-row-format"><span class="nav-text">3.1 row format</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-file-formatï¼ˆHDFSæ–‡ä»¶å­˜æ”¾çš„æ ¼å¼ï¼‰"><span class="nav-text">3.2 file formatï¼ˆHDFSæ–‡ä»¶å­˜æ”¾çš„æ ¼å¼ï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨"><span class="nav-text">3.3 å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Feature-comparison"><span class="nav-text">Feature comparison</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Managed-tables-å†…éƒ¨è¡¨"><span class="nav-text">Managed tables å†…éƒ¨è¡¨</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#External-tables-å¤–éƒ¨è¡¨"><span class="nav-text">External tables å¤–éƒ¨è¡¨</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#åŒºåˆ«"><span class="nav-text">åŒºåˆ«</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-Partitioned-Tables"><span class="nav-text">3.4 Partitioned Tables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-æ³•ä¸€ï¼šç›´æ¥å»ºè¡¨æ³•"><span class="nav-text">3.5 æ³•ä¸€ï¼šç›´æ¥å»ºè¡¨æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-5-1-ä¾‹å­ï¼šåˆ›å»ºå†…éƒ¨è¡¨"><span class="nav-text">3.5.1 ä¾‹å­ï¼šåˆ›å»ºå†…éƒ¨è¡¨</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-åˆ›å»ºè¡¨"><span class="nav-text">1. åˆ›å»ºè¡¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-æŸ¥çœ‹è¡¨çš„æè¿°"><span class="nav-text">2.æŸ¥çœ‹è¡¨çš„æè¿°</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-æ’å…¥æ•°æ®"><span class="nav-text">3. æ’å…¥æ•°æ®</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-æŸ¥çœ‹æ–‡ä»¶ä½ç½®"><span class="nav-text">4. æŸ¥çœ‹æ–‡ä»¶ä½ç½®</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#5-åˆ é™¤å†…éƒ¨è¡¨"><span class="nav-text">5. åˆ é™¤å†…éƒ¨è¡¨</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-5-2-ä¾‹å­ï¼šåˆ›å»ºå¤–éƒ¨è¡¨"><span class="nav-text">3.5.2 ä¾‹å­ï¼šåˆ›å»ºå¤–éƒ¨è¡¨</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-åˆ›å»ºè¡¨-1"><span class="nav-text">1. åˆ›å»ºè¡¨</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-è£…è½½æ•°æ®"><span class="nav-text">2. è£…è½½æ•°æ®</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-æŸ¥çœ‹æ–‡ä»¶ä½ç½®"><span class="nav-text">3. æŸ¥çœ‹æ–‡ä»¶ä½ç½®</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-åˆ é™¤å¤–éƒ¨è¡¨"><span class="nav-text">4. åˆ é™¤å¤–éƒ¨è¡¨</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-æ³•äºŒï¼šæŸ¥è¯¢å»ºè¡¨æ³•ï¼ˆCreate-Table-As-Select-CTAS-ï¼‰"><span class="nav-text">3.6 æ³•äºŒï¼šæŸ¥è¯¢å»ºè¡¨æ³•ï¼ˆCreate Table As Select (CTAS)ï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-æ³•ä¸‰ï¼šlikeå»ºè¡¨æ³•"><span class="nav-text">3.7 æ³•ä¸‰ï¼šlikeå»ºè¡¨æ³•</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Hiveä¸­è¡¨çš„ç±»å‹"><span class="nav-text">4. Hiveä¸­è¡¨çš„ç±»å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-å†…éƒ¨è¡¨ï¼ˆManaged-Tableï¼‰"><span class="nav-text">4.1 å†…éƒ¨è¡¨ï¼ˆManaged Tableï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-å¤–éƒ¨è¡¨ï¼ˆExternal-Tableï¼‰"><span class="nav-text">4.2 å¤–éƒ¨è¡¨ï¼ˆExternal Tableï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-ä¸´æ—¶è¡¨ï¼ˆTemporary-Tableï¼‰"><span class="nav-text">4.3 ä¸´æ—¶è¡¨ï¼ˆTemporary Tableï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-åˆ†åŒºè¡¨ï¼ˆPartitioned-Tableï¼‰"><span class="nav-text">4.4 åˆ†åŒºè¡¨ï¼ˆPartitioned Tableï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-åˆ†æ¡¶è¡¨ï¼ˆBucked-Tablesï¼‰"><span class="nav-text">4.5 åˆ†æ¡¶è¡¨ï¼ˆBucked Tablesï¼‰</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qypx</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  


  

  



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left"},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
